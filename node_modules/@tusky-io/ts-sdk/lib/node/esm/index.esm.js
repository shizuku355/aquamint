import{createRequire as e}from"node:module";var t={194:e=>{e.exports=require("micro-key-producer/password.js")},236:e=>{e.exports=require("tus-js-client")},325:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(3227),s=r(3420),a=r(1377);class Keystore{constructor(e){this.db=e}static async instance(){if(this._instance)return this._instance;try{return await this.persitentInstance()}catch(e){return await this.inMemoryInstance()}}static async persitentInstance(){const e=new i.BrowserLevel(Keystore.KEYSTORE_LOCATION,Keystore.DEFAULT_ENCODING_OPTIONS);return await e.open(),this._instance=new this(e)}static async inMemoryInstance(){const e=new s.MemoryLevel(Keystore.DEFAULT_INMEMORY_ENCODING_OPTIONS);return await e.open(),this._instance=new this(e)}async store(e,t){await this.db.put(e,t,Keystore.DEFAULT_ENCODING_OPTIONS)}async get(e){try{return await this.db.get(e,Keystore.DEFAULT_ENCODING_OPTIONS)}catch(e){e&&"LEVEL_NOT_FOUND"!==e.code&&a.logger.debug(e)}}async delete(e){await this.db.del(e)}async close(){await this.db.close()}}Keystore.KEYSTORE_LOCATION=".tusky/keystore",Keystore.DEFAULT_ENCODING_OPTIONS={valueEncoding:{encode:e=>e,decode:e=>e,format:"view"}},Keystore.DEFAULT_INMEMORY_ENCODING_OPTIONS={...Keystore.DEFAULT_ENCODING_OPTIONS,storeEncoding:"view"},t.default=Keystore},573:e=>{e.exports=require("rxjs")},587:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TuskyError=void 0;const i=r(1377);class TuskyError extends Error{constructor(e,t){super(e),this.requestId=t?.response?.headers?.["request-id"],i.logger.error(e),t&&t.response?(i.logger.error(`${t.response.status}: ${t.response.statusText}`),i.logger.debug(t.response.headers),i.logger.debug(t.response.data)):t&&i.logger.error(t)}}t.TuskyError=TuskyError},611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Membership=t.activeStatus=void 0;const i=r(7243),s=r(5744);t.activeStatus=["accepted","pending"];class Membership extends i.Encryptable{constructor(e,t){super(t),this.id=e.id,this.owner=e.owner,this.memberAddress=e.memberAddress,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.expiresAt=e.expiresAt,this.status=e.status,this.role=e.role,this.encPublicSigningKey=e.encPublicSigningKey,this.email=e.email,this.vaultId=e.vaultId,this.keys=e.keys,this.ownerAccess=e.ownerAccess,this.memberDetails=e.memberDetails?new s.User(e.memberDetails):void 0,this.allowedPaths=e.allowedPaths?JSON.parse(e.allowedPaths):void 0,this.__encrypted__=e.__encrypted__}}t.Membership=Membership},679:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrashModule=void 0;const i=r(3410);t.TrashModule=class TrashModule{constructor(e){this.service=new i.Service(e)}async get(){return await this.service.api.getTrash()}async empty(){return await this.service.api.emptyTrash()}}},781:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.JWTClient=t.defaultStorage=void 0;const i=r(4771),s=r(1984),a=r(1371),n="tusky";t.JWTClient=class JWTClient{constructor(e){this.storage=e?.storage||(0,t.defaultStorage)(),this.env=e?.env||s.DEFAULT_ENV,this.STORAGE_PATH_ACCESS_TOKEN=`${n}_${this.env}_access_token`,this.STORAGE_PATH_ID_TOKEN=`${n}_${this.env}_id_token`,this.STORAGE_PATH_REFRESH_TOKEN=`${n}_${this.env}_refresh_token`,this.STORAGE_PATH_ADDRESS=`${n}_${this.env}_address`,this.STORAGE_PATH_REFRESH_IN_PROGRESS=`${n}_${this.env}_refresh_in_progress`,this.refreshInProgress=!1}isTokenExpiringSoon(e,t=300){if(!e)throw new i.Unauthorized("Invalid session. Please log in again.");const r=decode(e);return Math.floor(Date.now()/1e3)>=r.exp-t}getRefreshInProgress(){return this.refreshInProgress="true"===this.storage.getItem(this.STORAGE_PATH_REFRESH_IN_PROGRESS),this.refreshInProgress}setRefreshInProgress(e){this.refreshInProgress=e,this.storage.setItem(this.STORAGE_PATH_REFRESH_IN_PROGRESS,e?"true":"false")}getAccessToken(){return this.accessToken=this.storage.getItem(this.STORAGE_PATH_ACCESS_TOKEN),this.accessToken}getRefreshToken(){return this.refreshToken=this.storage.getItem(this.STORAGE_PATH_REFRESH_TOKEN),this.refreshToken}getIdToken(){return this.idToken=this.storage.getItem(this.STORAGE_PATH_ID_TOKEN),this.idToken}setAccessToken(e){this.accessToken=e,this.storage.setItem(this.STORAGE_PATH_ACCESS_TOKEN,this.accessToken)}setRefreshToken(e){this.refreshToken=e,this.storage.setItem(this.STORAGE_PATH_REFRESH_TOKEN,this.refreshToken)}setIdToken(e){this.idToken=e,this.storage.setItem(this.STORAGE_PATH_ID_TOKEN,this.idToken)}setAddress(e){this.address=e,this.storage.setItem(this.STORAGE_PATH_ADDRESS,e)}getAddress(){return this.address||(this.address=this.storage.getItem(this.STORAGE_PATH_ADDRESS)),this.address}getUserId(){const e=this.getIdToken();return e?decode(e).sub:""}clearTokens(){this.storage.removeItem(this.STORAGE_PATH_ACCESS_TOKEN),this.storage.removeItem(this.STORAGE_PATH_ID_TOKEN),this.storage.removeItem(this.STORAGE_PATH_REFRESH_TOKEN),this.storage.removeItem(this.STORAGE_PATH_ADDRESS)}};const decode=e=>{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)};t.decode=decode;class MemoryStorage{constructor(){this.storage={}}setItem(e,t){this.storage[e]=t}getItem(e){return this.storage.hasOwnProperty(e)?this.storage[e]:null}removeItem(e){delete this.storage[e]}clear(){this.storage={}}get length(){return Object.keys(this.storage).length}key(e){return Object.keys(this.storage)[e]||null}}t.defaultStorage=()=>(0,a.isServer)()?new MemoryStorage:globalThis.sessionStorage},865:e=>{e.exports=require("@mysten/sui/keypairs/ed25519")},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Api=void 0;t.Api=class Api{constructor(){}}},878:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TooManyRequests=void 0;const i=r(587);class TooManyRequests extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=429}}t.TooManyRequests=TooManyRequests},1035:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TuskyApi=t.defaultFileUploadOptions=void 0;const i=r(874),s=r(9154),a=r(5504),n=r(6445);t.defaultFileUploadOptions={encrypted:!0};const o=1e3;class TuskyApi extends i.Api{constructor(e){super(),this.config=(0,s.apiConfig)(e.env),this.clientName=e.clientName,this.auth=e.auth}async generateJWT(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).authProvider(e.authProvider).grantType(e.grantType).authCode(e.authCode).refreshToken(e.refreshToken).redirectUri(e.redirectUri).publicRoute(!0).generateJWT()}async createAuthChallenge(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).address(e.address).publicRoute(!0).createAuthChallenge()}async verifyAuthChallenge(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).address(e.address).signature(e.signature).publicRoute(!0).verifyAuthChallenge()}async createFolder(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).vaultId(e.vaultId).parentId(e.parentId).name(e.name).createFolder()}async createFolderTree(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).vaultId(e.vaultId).parentId(e.parentId).data(e.paths).createFolderTree()}async updateFolder(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e.id).name(e.name).parentId(e.parentId).status(e.status).updateFolder()}async deleteFolder(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).deleteFolder()}async updateFile(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e.id).name(e.name).parentId(e.parentId).status(e.status).updateFile()}async deleteFile(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).deleteFile()}async createVault(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).encrypted(e.encrypted).name(e.name).description(e.description).tags(e.tags).keys(e.keys).createVault()}async updateVault(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e.id).name(e.name).description(e.description).tags(e.tags).status(e.status).updateVault()}async deleteVault(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).deleteVault()}async getTrash(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).getTrash()}async emptyTrash(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).emptyTrash()}async createMembership(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).vaultId(e.vaultId).address(e.address).role(e.role).expiresAt(e.expiresAt).keys(e.keys).name(e.name).encPrivateKey(e.encPrivateKey).ownerAccess(e.ownerAccess).allowedStorage(e.allowedStorage).allowedPaths(e.allowedPaths).createMembership()}async updateMembership(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e.id).role(e.role).status(e.status).expiresAt(e.expiresAt).keys(e.keys).updateMembership()}async deleteMembership(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e.id).keys(e.keys).deleteMembership()}async getMembers(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).vaultId(e).getMembers()}async downloadFile(e,t={}){const r=await(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).downloadFile();let i;return i="arraybuffer"===t.responseType?await r.arrayBuffer():r.body.getReader?r.body:n.StreamConverter.fromAsyncIterable(r.body),i}async getStorage(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).getStorage()}async getMe(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).getMe()}async updateMe(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).name(e.name).picture(e.picture).updateMe()}async createEncryptionKeys(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).publicKey(e.publicKey).encPrivateKey(e.encPrivateKey).encPrivateKeyBackup(e.encPrivateKeyBackup).createEncryptionKeys()}async updateEncryptionKeys(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).publicKey(e.publicKey).encPrivateKey(e.encPrivateKey).encPrivateKeyBackup(e.encPrivateKeyBackup).updateEncryptionKeys()}async deleteEncryptionKeys(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).deleteEncryptionKeys()}async getFile(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).getFile()}async getFolder(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).getFolder()}async getMembership(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).getMembership()}async getVault(e,t){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).queryParams({withNodes:t?.withNodes,withMemberships:t?.deep,withMemos:t?.deep,withStacks:t?.deep,withFolders:t?.deep}).getVault()}async getVaults(e={}){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).queryParams({status:e.status,limit:e.limit||o,nextToken:e.nextToken}).getVaults()}async getFiles(e={}){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).queryParams({vaultId:e.vaultId,parentId:e.parentId,status:e.status,limit:e.limit||o,nextToken:e.nextToken}).getFiles()}async getFolders(e={}){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).queryParams({vaultId:e.vaultId,parentId:e.parentId,status:e.status,limit:e.limit||o,nextToken:e.nextToken}).getFolders()}async getApiKeys(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).getApiKeys()}async generateApiKey(){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).generateApiKey()}async revokeApiKey(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).revokeApiKey()}async getCollection(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).getCollection()}async getNft(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).resourceId(e).getNft()}async getNfts(e={}){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).queryParams({status:e.status,parentId:e.parentId,limit:e.limit||o,nextToken:e.nextToken}).getNfts()}async getCollections(e={}){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).queryParams({status:e.status,parentId:e.parentId,limit:e.limit||o,nextToken:e.nextToken}).getCollections()}async mintNft(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).name(e.name).description(e.description).recipient(e.recipient).creator(e.creator).thumbnailUrl(e.thumbnailUrl).link(e.link).projectUrl(e.projectUrl).resourceId(e.fileId).mintNft()}async mintCollection(e){return(new a.ApiClient).env(this.config).clientName(this.clientName).auth(this.auth).description(e.description).recipient(e.recipient).creator(e.creator).thumbnailUrl(e.thumbnailUrl).link(e.link).projectUrl(e.projectUrl).resourceId(e.folderId).mintCollection()}}t.default=TuskyApi,t.TuskyApi=TuskyApi},1157:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VaultEncryption=void 0;const i=r(9469),s=r(8072),a=r(7604),n=r(5334),o=r(6408);t.VaultEncryption=class VaultEncryption{constructor(e={}){if(!e.vaultKeys||0===e.vaultKeys.length)throw new Error("Keys are required for vault encryption.");this.vaultKeys=e.vaultKeys,this.currentPublicKey=this.vaultKeys[this.vaultKeys.length-1].publicKey,this.userEncrypter=e.userEncrypter}async generateAesKey(){const e=await(0,a.generateKey)(!0),t=await(0,a.exportKeyToArray)(e);return{aesKey:e,encryptedAesKey:await(0,a.encryptWithPublicKey)((0,n.base64ToArray)(this.currentPublicKey),t)}}async decryptAesKey(e){const t=(0,n.base64ToJson)(e),r=await this.decryptVaultPrivateKey(t),o=new i.Encrypter({keypair:new s.X25519KeyPair(r)}),c=await o.decrypt(e);return await(0,a.importKeyFromArray)(c,!0)}async encryptHybrid(e){const{aesKey:t,encryptedAesKey:r}=await this.generateAesKey(),i=await(0,a.encryptAes)(e,t),s={encryptedData:(0,n.base64ToJson)(i),encryptedKey:r};return(0,n.jsonToBase64)(s)}async decryptHybrid(e){const t=(0,n.base64ToJson)(e),r=await this.decryptAesKey((0,n.jsonToBase64)(t.encryptedKey)),i=await(0,a.decryptAes)((0,n.jsonToBase64)(t.encryptedData),r);return new Uint8Array(i)}async decryptVaultPrivateKey(e){const t=this.vaultKeys.find((t=>t.publicKey===e.publicKey)).encPrivateKey;if(!t)throw new o.IncorrectEncryptionKey(new Error("Missing file encryption context."));if(!this.userEncrypter)throw new o.IncorrectEncryptionKey(new Error("Missing user encryption context."));return await this.userEncrypter.decrypt(t)}}},1321:e=>{e.exports=require("reflect-metadata")},1331:e=>{e.exports=require("jssha")},1371:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getPlatform=t.isDeno=t.isNode=t.isServer=t.Platform=void 0,function(e){e[e.Browser=0]="Browser",e[e.BrowserNoWorker=1]="BrowserNoWorker",e[e.Server=2]="Server"}(r||(t.Platform=r={}));t.isServer=()=>(0,t.isNode)()||(0,t.isDeno)();t.isNode=()=>"undefined"!=typeof process&&"node"===process.release?.name;t.isDeno=()=>window&&"Deno"in window;t.getPlatform=()=>"undefined"==typeof window?r.Server:navigator.serviceWorker?.controller?r.Browser:r.BrowserNoWorker},1377:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.setLogger=t.ConsoleLogger=void 0;const i=r(2373),s=r(1371);var a;!function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.NONE=5]="NONE"}(a||(a={}));class ConsoleLogger{constructor(e){this.currentLogLevel=ConsoleLogger.logLevelMap[e?.logLevel?.toLowerCase()]??a.NONE,this._logToFile=e.logToFile}shouldLog(e){return e>=this.currentLogLevel}shouldLogToFile(){return this._logToFile&&(0,s.isServer)()}logToFile(e){const t=(0,i.importDynamic)("fs"),r=(0,i.importDynamic)("util"),s=`${(new Date).toISOString()} [${this.currentLogLevel}] ${r.inspect(e,{depth:null,colors:!1})}\n`;t.appendFileSync("tusky.log",s)}info(e,...t){this.shouldLog(a.INFO)&&(console.info(`[INFO] ${stringify(e)}`,...t),this.shouldLogToFile()&&this.logToFile(e))}warn(e,...t){this.shouldLog(a.WARN)&&(console.warn(`[WARN] ${stringify(e)}`,...t),this.shouldLogToFile()&&this.logToFile(e))}error(e,...t){this.shouldLog(a.ERROR)&&(console.error(`[ERROR] ${e}`,...t),this.shouldLogToFile()&&this.logToFile(e))}debug(e,...t){this.shouldLog(a.DEBUG)&&(console.debug(`[DEBUG] ${stringify(e)}`,...t),this.shouldLogToFile()&&this.logToFile(e))}}function stringify(e){return e&&"object"==typeof e?JSON.stringify(e):e}t.ConsoleLogger=ConsoleLogger,ConsoleLogger.logLevelMap={none:a.NONE,debug:a.DEBUG,info:a.INFO,warn:a.WARN,error:a.ERROR};let n=new ConsoleLogger({logLevel:"none"});t.logger=n,t.setLogger=function setLogger(e){t.logger=n=e||n}},1388:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.paginate=t.processListItems=void 0;const s=i(r(8082)),a=r(8991);t.processListItems=async(e,t)=>{const r=new s.default({concurrency:1});try{await r.addAll(e.map((e=>()=>t(e))))}catch(e){throw new a.InternalError(e.toString(),e)}await r.onIdle()};t.paginate=async(e,t)=>{let r,i=[];do{const{items:s,nextToken:a}=await e(t);i=i.concat(s),r=a,t.nextToken=a,"null"===a&&(r=void 0)}while(r);return i}},1431:e=>{function webpackEmptyContext(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=1431,e.exports=webpackEmptyContext},1608:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(9019),t)},1676:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Forbidden=void 0;const i=r(587);class Forbidden extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=403}}t.Forbidden=Forbidden},1802:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;const i=r(8495);t.Storage=class Storage{constructor(e){this.owner=e.owner,this.host=e.host,this.storageAvailable=e.storageAvailable,this.storageTotal=e.storageTotal,this.audio=e.audio,this.documents=e.documents,this.other=e.other,this.photos=e.photos,this.video=e.video,this.trash=e.trash?new i.Folder(e.trash):void 0,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.refreshedAt=e.refreshedAt}}},1911:e=>{e.exports=require("@noble/hashes/utils")},1984:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ENV=t.Envs=void 0,function(e){e.PROD="prod",e.DEV="dev",e.LOCAL="local"}(r||(t.Envs=r={})),t.DEFAULT_ENV=r.PROD},2024:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkError=void 0;const i=r(587);class NetworkError extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=503}}t.NetworkError=NetworkError},2203:t=>{t.exports=e(import.meta.url)("stream")},2222:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=globalThis.crypto||undefined},2228:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorageModule=void 0;const i=r(3410);t.StorageModule=class StorageModule{constructor(e){this.service=new i.Service(e)}async get(){return await this.service.api.getStorage()}}},2373:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.importDynamic=void 0;t.importDynamic=e=>{const t=r(4120)(e);return t.default||t}},2497:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceUnavailable=void 0;const i=r(587);class ServiceUnavailable extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=503}}t.ServiceUnavailable=ServiceUnavailable},2640:(e,t)=>{var r,i,s,a,n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.actions=t.role=t.apiKeyStatus=t.membershipStatus=t.status=t.objects=void 0,function(e){e.VAULT="Vault",e.MEMBERSHIP="Membership",e.FILE="File",e.FOLDER="Folder"}(r||(t.objects=r={})),function(e){e.ACTIVE="active",e.DELETED="deleted"}(i||(t.status=i={})),function(e){e.PENDING="pending",e.ACCEPTED="accepted",e.REJECTED="rejected",e.REVOKED="revoked"}(s||(t.membershipStatus=s={})),function(e){e.ACTIVE="active",e.REVOKED="revoked"}(a||(t.apiKeyStatus=a={})),function(e){e.OWNER="owner",e.CONTRIBUTOR="contributor",e.VIEWER="viewer"}(n||(t.role=n={})),function(e){e.VAULT_CREATE="vault:init",e.VAULT_UPDATE="vault:update",e.VAULT_DELETE="vault:delete",e.VAULT_RESTORE="vault:restore",e.MEMBERSHIP_AIRDROP_ACCESS="membership:airdrop-access",e.MEMBERSHIP_CHANGE_ACCESS="membership:change-access",e.MEMBERSHIP_REVOKE_ACCESS="membership:revoke-access",e.MEMBERSHIP_LEAVE="membership:leave",e.FILE_CREATE="file:create",e.FILE_MOVE="file:move",e.FILE_DELETE="file:delete",e.FILE_RESTORE="file:restore",e.FILE_UPDATE="file:update",e.FOLDER_CREATE="folder:create",e.FOLDER_MOVE="folder:move",e.FOLDER_DELETE="folder:delete",e.FOLDER_RESTORE="folder:restore",e.FOLDER_UPDATE="folder:update"}(o||(t.actions=o={}))},2698:e=>{e.exports=require("p-limit")},2866:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ZipModule=void 0;const n=r(5376),o=r(7002),c=r(3410),u=a(r(236)),h=r(7099);t.ZipModule=class ZipModule{constructor(e){this.service=new c.Service(e),this.auth=e.auth}async uploader(e,t=null,r={}){if((await this.service.api.getVault(e)).encrypted)throw new o.BadRequest("Zip upload is not supported for encrypted vaults");let i=null;if(t&&(i=await(0,n.fileSourceToTusFile)(t),0===i.size))throw new o.BadRequest(h.EMPTY_FILE_ERROR_MESSAGE);return new u.Upload(i,{endpoint:`${this.service.api.config.apiUrl}/uploads`,retryDelays:[0,500,2e3,5e3],metadata:{vaultId:e,parentId:r?.parentId||e,filetype:"application/zip"},uploadDataDuringCreation:!0,parallelUploads:1,chunkSize:h.CHUNK_SIZE_IN_BYTES,headers:{...await this.auth.getAuthorizationHeader()},removeFingerprintOnSuccess:!0,onError:r.onError,onProgress:r.onProgress,onSuccess:r.onSuccess})}async upload(e,t,r={}){const i=await this.uploader(e,t,r);await new Promise(((e,t)=>{i.options.onSuccess=()=>{r.onSuccess&&r.onSuccess(),e()},i.options.onError=e=>{r.onError&&r.onError(e),t(e)},i.start()}));return i.url.split("/").pop()}}},2988:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserEncryption=void 0;const o=r(5334),c=r(7604),u=n(r(325)),h=r(6408),l=r(1377),p=r(8072),d=r(781),y=a(r(8191)),_=r(4007);t.UserEncryption=class UserEncryption{constructor(e={}){this.encPrivateKey=e.encPrivateKey,this.encPrivateKeyBackup=e.encPrivateKeyBackup,this.storage=e.storage||(0,d.defaultStorage)(),this.userId=new d.JWTClient(e).getUserId(),this.sessionKeyPath=`${this.userId}_session_key`,this.encryptedPasswordKeyPath=`${this.userId}_encrypted_password_key`}setEncryptedPrivateKey(e){this.encPrivateKey=e}setEncryptedPrivateKeyBackup(e){this.encPrivateKeyBackup=e}async setupPassword(e,t=!1){const r=await(0,c.generateKeyPair)();return this.encPrivateKey=await this.encryptWithPassword(e,r.privateKey,t),{keypair:new p.X25519KeyPair(r.privateKey),encPrivateKey:this.encPrivateKey}}async changePassword(e,t,r=!1){const i=await this.decryptWithPassword(e,this.encPrivateKey);return this.encPrivateKey=await this.encryptWithPassword(t,i,r),{encPrivateKey:this.encPrivateKey}}async backupPassword(e){const t=await this.decryptWithPassword(e,this.encPrivateKey),r=y.generateMnemonic(256);return this.encPrivateKeyBackup=await this.encryptWithBackupPhrase(r,t),{backupPhrase:r,encPrivateKeyBackup:this.encPrivateKeyBackup}}async resetPassword(e,t,r=!1){const i=await this.decryptWithBackupPhrase(e,this.encPrivateKeyBackup);return this.encPrivateKey=await this.encryptWithPassword(t,i,r),{encPrivateKey:this.encPrivateKey}}async importFromKeystore(){if(!this.encPrivateKey)throw new h.IncorrectEncryptionKey(new Error("Missing encrypted private key data."));const e=await this.hasEncryptionSession();if(!e)throw new h.IncorrectEncryptionKey(new Error("The user needs to provide the password again."));const{ciphertext:t,iv:r}=(0,c.decodeAesPayload)(e.encryptedPasswordKey),i=await(0,c.decryptAes)({ciphertext:t,iv:r},e.sessionKey),s=await(0,c.importKeyFromArray)(new Uint8Array(i)),a=(0,o.base64ToJson)(this.encPrivateKey),n=await(0,c.decryptAes)(a.encryptedPayload,s);return{keypair:new p.X25519KeyPair(new Uint8Array(n))}}async importFromPassword(e,t=!1){if(!e)throw new h.IncorrectEncryptionKey(new Error("Missing password to decrypt user keys."));if(!this.encPrivateKey)throw new h.IncorrectEncryptionKey(new Error("Missing encrypted private key data."));const r=await this.decryptWithPassword(e,this.encPrivateKey,t);return{keypair:new p.X25519KeyPair(r)}}async importFromBackupPhrase(e){if(!e)throw new h.IncorrectEncryptionKey(new Error("Missing backup phrase to decrypt user keys."));if(!this.encPrivateKeyBackup)throw new h.IncorrectEncryptionKey(new Error("Missing encrypted private key backup data."));const t=await this.decryptWithBackupPhrase(e,this.encPrivateKeyBackup);return{keypair:new p.X25519KeyPair(t)}}async encryptWithPassword(e,t,r=!1){try{const i=crypto.getRandomValues(new Uint8Array(16)),s=await(0,c.deriveAesKey)(e,i,c.KEY_DERIVATION_ITERATION_COUNT),a={encryptedPayload:await(0,c.encryptAes)(t,s),salt:(0,o.arrayToBase64)(i),iterationCount:c.KEY_DERIVATION_ITERATION_COUNT};return r&&await this.saveSessionInKeystore(s),(0,o.jsonToBase64)(a)}catch(e){throw l.logger.error(e),new h.IncorrectEncryptionKey(new Error("Encrypting data failed."))}}async decryptWithPassword(e,t,r=!1){try{const i=(0,o.base64ToJson)(t);if(!i.salt||!i.encryptedPayload)throw new _.Conflict("Malformed encrypted payload.");const s=(0,o.base64ToArray)(i.salt),a=await(0,c.deriveAesKey)(e,s,i.iterationCount||15e4),n=await(0,c.decryptAes)(i.encryptedPayload,a);return r&&await this.saveSessionInKeystore(a),new Uint8Array(n)}catch(e){throw l.logger.error(e),new h.IncorrectEncryptionKey(new Error("Decrypting data failed."))}}async encryptWithBackupPhrase(e,t){return this.encryptWithPassword(e,t,!1)}async decryptWithBackupPhrase(e,t){return this.decryptWithPassword(e,t,!1)}async hasEncryptionSession(){const e=await u.default.instance(),t=await e.get(this.sessionKeyPath);if(!t)return!1;const r=this.storage.getItem(this.encryptedPasswordKeyPath);return!!r&&{sessionKey:t,encryptedPasswordKey:r}}async clear(){const e=await u.default.instance();await e.delete(this.sessionKeyPath),await e.delete(this.encryptedPasswordKeyPath)}async saveSessionInKeystore(e){const t=await(0,c.generateKey)(),r=await(0,c.exportKeyToArray)(e),i=await(0,c.encryptAes)(r,t);this.storage.setItem(this.encryptedPasswordKeyPath,i);const s=await u.default.instance();await s.store(this.sessionKeyPath,t)}}},3227:e=>{e.exports=require("@akord/browser-level")},3288:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMimeTypeFromFileName=t.mimeTypeToExtension=void 0;const i=r(7099);t.mimeTypeToExtension={"audio/x-mpeg":"mpega","application/postscript":"ps","audio/x-aiff":"aiff","application/x-aim":"aim","image/x-jg":"art","video/x-ms-asf":"asx","audio/basic":"ulw","video/x-msvideo":"avi","video/x-rad-screenplay":"avx","application/x-bcpio":"bcpio","application/octet-stream":"exe","image/bmp":"dib","text/html":"html","application/x-cdf":"cdf","application/pkix-cert":"cer","application/java":"class","application/x-cpio":"cpio","application/x-csh":"csh","text/css":"css","application/msword":"doc","application/xml-dtd":"dtd","video/x-dv":"dv","application/x-dvi":"dvi","application/vnd.ms-fontobject":"eot","text/x-setext":"etx","image/gif":"gif","application/x-gtar":"gtar","application/x-gzip":"gz","application/x-hdf":"hdf","application/mac-binhex40":"hqx","text/x-component":"htc","image/ief":"ief","text/vnd.sun.j2me.app-descriptor":"jad","application/java-archive":"jar","text/x-java-source":"java","application/x-java-jnlp-file":"jnlp","image/jpeg":"jpeg","application/javascript":"js","text/plain":"txt","application/json":"json","audio/midi":"midi","application/x-latex":"latex","audio/x-mpegurl":"m3u","image/x-macpaint":"pnt","text/troff":"tr","application/mathml+xml":"mathml","application/x-mif":"mif","video/quicktime":"qt","video/x-sgi-movie":"movie","audio/mpeg":"mpa","video/mp4":"mp4","video/mpeg":"mpg","video/mpeg2":"mpv2","application/x-wais-source":"src","application/x-netcdf":"nc","application/oda":"oda","application/vnd.oasis.opendocument.database":"odb","application/vnd.oasis.opendocument.chart":"odc","application/vnd.oasis.opendocument.formula":"odf","application/vnd.oasis.opendocument.graphics":"odg","application/vnd.oasis.opendocument.image":"odi","application/vnd.oasis.opendocument.text-master":"odm","application/vnd.oasis.opendocument.presentation":"odp","application/vnd.oasis.opendocument.spreadsheet":"ods","application/vnd.oasis.opendocument.text":"odt","application/vnd.oasis.opendocument.graphics-template":"otg","application/vnd.oasis.opendocument.text-web":"oth","application/vnd.oasis.opendocument.presentation-template":"otp","application/vnd.oasis.opendocument.spreadsheet-template":"ots","application/vnd.oasis.opendocument.text-template":"ott","application/ogg":"ogx","video/ogg":"ogv","audio/ogg":"spx","application/x-font-opentype":"otf","audio/flac":"flac","application/annodex":"anx","audio/annodex":"axa","video/annodex":"axv","application/xspf+xml":"xspf","image/x-portable-bitmap":"pbm","image/pict":"pict","application/pdf":"pdf","image/x-portable-graymap":"pgm","audio/x-scpls":"pls","image/png":"png","image/x-portable-anymap":"pnm","image/x-portable-pixmap":"ppm","application/vnd.ms-powerpoint":"pps","image/vnd.adobe.photoshop":"psd","image/x-quicktime":"qtif","image/x-cmu-raster":"ras","application/rdf+xml":"rdf","image/x-rgb":"rgb","application/vnd.rn-realmedia":"rm","application/rtf":"rtf","text/richtext":"rtx","application/font-sfnt":"sfnt","application/x-sh":"sh","application/x-shar":"shar","application/x-stuffit":"sit","application/x-sv4cpio":"sv4cpio","application/x-sv4crc":"sv4crc","image/svg+xml":"svgz","application/x-shockwave-flash":"swf","application/x-tar":"tar","application/x-tcl":"tcl","application/x-tex":"tex","application/x-texinfo":"texinfo","image/tiff":"tiff","text/tab-separated-values":"tsv","application/x-font-ttf":"ttf","application/x-ustar":"ustar","application/voicexml+xml":"vxml","image/x-xbitmap":"xbm","application/xhtml+xml":"xhtml","application/vnd.ms-excel":"xls","application/xml":"xsl","image/x-xpixmap":"xpm","application/xslt+xml":"xslt","application/vnd.mozilla.xul+xml":"xul","image/x-xwindowdump":"xwd","application/vnd.visio":"vsd","audio/x-wav":"wav","image/vnd.wap.wbmp":"wbmp","text/vnd.wap.wml":"wml","application/vnd.wap.wmlc":"wmlc","text/vnd.wap.wmlsc":"wmls","application/vnd.wap.wmlscriptc":"wmlscriptc","video/x-ms-wmv":"wmv","application/font-woff":"woff","application/font-woff2":"woff2","model/vrml":"wrl","application/wspolicy+xml":"wspolicy","application/x-compress":"z","application/zip":"zip"};const s={aac:"audio/aac",abw:"application/x-abiword",apng:"image/apng",arc:"application/x-freearc",avif:"image/avif",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};t.getMimeTypeFromFileName=function getMimeTypeFromFileName(e){const t=e?.split(".").pop();return s[t?.toLowerCase()]||i.DEFAULT_FILE_TYPE}},3363:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var s,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(n=(a<3?s(n):a>3?s(t,r,n):s(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.File=void 0;const s=r(7243);class File extends s.Encryptable{constructor(e,t){super(t||e.__keys__),this.id=e.id,this.blobId=e.blobId,this.ref=e.ref,this.owner=e.owner,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.mimeType=e.mimeType,this.size=e.size,this.numberOfChunks=e.numberOfChunks,this.chunkSize=e.chunkSize,this.encryptedAesKey=e.encryptedAesKey,this.name=e.name,this.status=e.status,this.external=e.external,this.expiresAt=e.expiresAt,this.vaultId=e.vaultId,this.parentId=e.parentId,this.tags=e.tags,this.__encrypted__=e.__encrypted__}}t.File=File,i([(0,s.encrypted)()],File.prototype,"name",void 0)},3410:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Service=t.STATE_CONTENT_TYPE=void 0;const i=r(7243),s=r(1157);t.STATE_CONTENT_TYPE="application/json";t.Service=class Service{constructor(e){this.signer=e.signer,this.api=e.api,this.pubsub=e.pubsub,this.encrypter=e.encrypter,this.address=e.address,this.vault=e.vault,this.vaultId=e.vaultId,this.keys=e.keys,this.decryptedKeys=e.decryptedKeys||[],this.objectId=e.objectId,this.encrypted=e.encrypted,this.type=e.type,this.object=e.object,this.groupRef=e.groupRef,this.clientName=e.clientName,this.storage=e.storage,this.env=e.env}setKeys(e){this.keys=e}setDecryptedKeys(e){this.decryptedKeys=e}async decryptKeys(){if((!this.decryptedKeys||0===this.decryptedKeys.length)&&(this.decryptedKeys=[],this.keys&&this.keys.length>0))for(let e of this.keys){const t=await this.encrypter.decrypt(e.encPrivateKey);this.decryptedKeys.push({publicKey:(0,i.base64ToArray)(e.publicKey),privateKey:t})}}setVaultId(e){this.vaultId=e}setParentId(e){this.parentId=e}setObjectId(e){this.objectId=e}setGroupRef(e){this.groupRef=e}setObject(e){this.object=e}setEncrypted(e){this.encrypted=e}setVault(e){this.vault=e}async processWriteString(e){if(!this.encrypted)return e;const t=new s.VaultEncryption({vaultKeys:this.keys});return await t.encryptHybrid((0,i.stringToArray)(e))}async setVaultContext(e){const t=await this.api.getVault(e);this.setVault(t),this.setVaultId(e),this.setEncrypted(t.encrypted),await this.setMembershipKeys(t)}async setMembershipKeys(e){this.encrypted&&this.setKeys(e.__keys__)}}},3420:e=>{e.exports=require("memory-level")},3453:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VaultService=void 0;const i=r(3410),s=r(6408),a=r(3491),n=r(2640);class VaultService extends i.Service{constructor(e){super(e),this.type=n.objects.VAULT}async setName(e){this.name=await this.processWriteString(e)}async setDescription(e){this.description=await this.processWriteString(e)}async setVaultContext(e){await super.setVaultContext(e),this.setObjectId(e),this.setObject(this.vault)}async processVault(e,t,r){const i=new a.Vault(e,r);if(t&&i.encrypted)try{await i.decrypt(this.encrypter)}catch(e){throw new s.IncorrectEncryptionKey(e)}return i}}t.VaultService=VaultService},3491:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(611),t),s(r(4059),t),s(r(5744),t),s(r(4387),t),s(r(8495),t),s(r(3363),t),s(r(6036),t),s(r(1802),t),s(r(7205),t),s(r(4048),t),s(r(1984),t),s(r(3628),t),s(r(5376),t)},3628:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3770:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(9987),t)},3903:e=>{e.exports=require("uuid")},4007:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Conflict=void 0;const i=r(587);class Conflict extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=409}}t.Conflict=Conflict},4048:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nextToken=t.isPaginated=void 0;const r="nextToken";t.isPaginated=e=>void 0!==e.data[r];t.nextToken=e=>"null"===e.data[r]?"":e.headers[r]},4059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4120:e=>{function webpackEmptyContext(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=4120,e.exports=webpackEmptyContext},4164:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;const i=r(4771),s=r(1377),a=r(865),n=r(6527),o=r(1035),c=r(781),u=r(7002),h=r(7313),l=r(5504);t.Auth=class Auth{constructor(e={authType:"OAuth"}){this.authType=e.authType,this.apiKey=e.apiKey,this.env=e.env,this.signPersonalMessage=e.signPersonalMessage,this.account=e.account,this.keypair=e.keypair||e.privateKey&&a.Ed25519Keypair.fromSecretKey((0,h.decodeSuiPrivateKey)(e.privateKey).secretKey),this.authProvider=e.authProvider,this.clientId=e.clientId,this.redirectUri=e.redirectUri,this.storage=e.storage||(0,c.defaultStorage)(),this.jwtClient=new c.JWTClient({storage:this.storage,env:this.env})}async signIn(){switch(this.authType){case"Wallet":{let e;if(this.signPersonalMessage&&this.account)e=this.account.address;else{if(!this.keypair)throw new i.Unauthorized("Missing wallet signing function for Wallet based auth.");e=this.keypair.toSuiAddress()}const t=new o.TuskyApi({env:this.env}),{nonce:r}=await t.createAuthChallenge({address:e}),a=(new TextEncoder).encode("tusky:connect:"+r);let n;if(this.signPersonalMessage){n=await new Promise(((e,t)=>{this.signPersonalMessage({message:a},{onSuccess:t=>{s.logger.info("Message signed on client: "+t.signature),e(t.signature)},onError:e=>{s.logger.info("Error signing on client: "+e),t(e)}})}))}else{if(!this.keypair)throw new i.Unauthorized("Missing wallet signing function for Wallet based auth.");{const{signature:e}=await this.keypair.signPersonalMessage(a);n=e}}const{idToken:c}=await t.verifyAuthChallenge({signature:n,address:e});return this.jwtClient.setAddress(e),this.jwtClient.setIdToken(c),{address:e}}case"OAuth":{const e=window.location.search,t=new URLSearchParams(e).get("code"),r=new n.OAuth({clientId:this.clientId,redirectUri:this.redirectUri,authProvider:this.authProvider,storage:this.storage,env:this.env});if(t){const{address:e}=await r.handleOAuthCallback();return{address:e}}return s.logger.info("No authorization code found, redirecting to OAuth provider..."),await r.initOAuthFlow(),{}}default:throw new u.BadRequest(`Missing or unsupported auth type for sign in: ${this.authType}`)}}signOut(){this.jwtClient.clearTokens()}async initOAuthFlow(){const e=new n.OAuth({clientId:this.clientId,redirectUri:this.redirectUri,authProvider:this.authProvider,storage:this.storage,env:this.env});await e.initOAuthFlow()}async handleOAuthCallback(){return new n.OAuth({clientId:this.clientId,redirectUri:this.redirectUri,authProvider:this.authProvider,storage:this.storage,env:this.env}).handleOAuthCallback()}async getAuthorizationHeader(){switch(this.authType){case"ApiKey":if(this.apiKey)return{"Api-Key":this.apiKey};throw new i.Unauthorized("Please add apiKey into config.");case"OAuth":{let e=this.jwtClient.getIdToken();if(!e)throw new i.Unauthorized("Invalid session.");return this.jwtClient.isTokenExpiringSoon(e)&&await(0,l.retry)((async()=>{if(this.jwtClient.getRefreshInProgress()){if(s.logger.info("Refresh already in progress..."),!this.jwtClient.getIdToken())throw new i.Unauthorized("Invalid session.")}else{s.logger.info("Token is expired or about to expire. Refreshing tokens...");const t=new n.OAuth({clientId:this.clientId,redirectUri:this.redirectUri,authProvider:this.authProvider,storage:this.storage,env:this.env});await t.refreshTokens(),s.logger.info("Tokens refreshed successfully."),e=this.jwtClient.getIdToken()}}),!0),{Authorization:`Bearer ${e}`}}case"Wallet":{let e=this.jwtClient.getIdToken();if(!e)throw new i.Unauthorized("Invalid session.");if(this.jwtClient.isTokenExpiringSoon(e,0))throw new i.Unauthorized("JWT is expired, please log in again.");return{Authorization:`Bearer ${e}`}}default:throw new i.Unauthorized(`Missing or unsupported auth type: ${this.authType}`)}}getAddress(){switch(this.authType){case"OAuth":case"Wallet":return this.jwtClient.getAddress();default:return}}}},4188:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateListPaginatedApiOptions=void 0;const i=r(7002);t.validateListPaginatedApiOptions=e=>{if(e.limit<1||e.limit>1e3)throw new i.BadRequest("Invalid limit parameter, please provide a value from 1 to 1000")}},4293:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NFTModule=void 0;const i=r(3410),s=r(1388);t.NFTModule=class NFTModule{constructor(e){this.service=new i.Service(e)}async mint(e){return this.service.api.mintNft(e)}async mintCollection(e){return this.service.api.mintCollection(e)}async get(e){return this.service.api.getNft(e)}async getCollection(e){return this.service.api.getCollection(e)}async list(e={}){return this.service.api.getNfts(e)}async listAll(e={}){return(0,s.paginate)((async e=>this.list(e)),e)}async listCollections(){return this.service.api.getCollections()}async listAllCollections(){return(0,s.paginate)((async()=>this.listCollections()),{})}}},4387:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var s,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(n=(a<3?s(n):a>3?s(t,r,n):s(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Vault=void 0;const s=r(7243);class Vault extends s.Encryptable{constructor(e,t){super(t),this.id=e.id,this.owner=e.owner,this.encrypted=e.encrypted,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.size=e.size,this.trash=e.trash,this.name=e.name,this.description=e.description,this.tags=e.tags,this.status=e.status}}t.Vault=Vault,i([(0,s.encrypted)()],Vault.prototype,"name",void 0),i([(0,s.encrypted)()],Vault.prototype,"description",void 0)},4441:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GatewayTimeout=void 0;const i=r(587);class GatewayTimeout extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=504}}t.GatewayTimeout=GatewayTimeout},4615:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof window&&(global.__non_webpack_require__=r(1431)),s(r(2222),t)},4771:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Unauthorized=void 0;const i=r(587);class Unauthorized extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=401}}t.Unauthorized=Unauthorized},4819:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MeModule=void 0;const i=r(3410),s=r(2988),a=r(7002),n=r(7243);t.MeModule=class MeModule{constructor(e){this.service=new i.Service(e),this.userEncryption=new s.UserEncryption(e)}async get(){return await this.service.api.getMe()}async update(e){return await this.service.api.updateMe(e)}async setupPassword(e){if((await this.get()).encPrivateKey)throw new a.BadRequest("User encryption context is already setup");const{encPrivateKey:t,keypair:r}=await this.userEncryption.setupPassword(e,!0);return{user:await this.service.api.createEncryptionKeys({encPrivateKey:t,publicKey:(0,n.arrayToBase64)(r.getPublicKey())}),keypair:r}}async changePassword(e,t){const r=await this.get();if(!r.encPrivateKey)throw new a.BadRequest("Missing user encryption context, setup the user password first.");this.userEncryption.setEncryptedPrivateKey(r.encPrivateKey);const{encPrivateKey:i}=await this.userEncryption.changePassword(e,t,!0);return await this.service.api.updateEncryptionKeys({encPrivateKey:i})}async backupPassword(e){const t=await this.get();if(!t.encPrivateKey)throw new a.BadRequest("Missing user encryption context, setup the user password first.");this.userEncryption.setEncryptedPrivateKey(t.encPrivateKey);const{backupPhrase:r,encPrivateKeyBackup:i}=await this.userEncryption.backupPassword(e);return{user:await this.service.api.updateEncryptionKeys({encPrivateKeyBackup:i}),backupPhrase:r}}async resetPassword(e,t){const r=await this.get();if(!r.encPrivateKeyBackup)throw new a.BadRequest("Missing user backup.");this.userEncryption.setEncryptedPrivateKeyBackup(r.encPrivateKeyBackup);const{encPrivateKey:i}=await this.userEncryption.resetPassword(e,t);return await this.service.api.updateEncryptionKeys({encPrivateKey:i})}async resetEncryptionKeys(){return this.service.api.deleteEncryptionKeys()}async hasEncryptionSession(){return!!await this.userEncryption.hasEncryptionSession()}async clearEncryptionSession(){await this.userEncryption.clear()}async importEncryptionSessionFromPassword(e){const t=await this.get();this.userEncryption.setEncryptedPrivateKey(t.encPrivateKey);const{keypair:r}=await this.userEncryption.importFromPassword(e,!0);return{keypair:r}}async importEncryptionSessionFromKeystore(){const e=await this.get();this.userEncryption.setEncryptedPrivateKey(e.encPrivateKey);const{keypair:t}=await this.userEncryption.importFromKeystore();return{keypair:t}}}},4855:e=>{e.exports=require("@noble/curves/ed25519")},5201:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MembershipService=void 0;const i=r(2640),s=r(3410),a=r(6408),n=r(3491),o=r(7243),c=r(7604);class MembershipService extends s.Service{constructor(e){super(e),this.type=i.objects.MEMBERSHIP}async setVaultContextFromMembershipId(e){const t=await this.api.getMembership(e),r=await this.api.getVault(t.vaultId);this.setVault(r),this.setVaultId(t.vaultId),this.setEncrypted(t.__encrypted__),await this.setMembershipKeys(t),this.setObject(t),this.setObjectId(e)}async prepareMemberKeys(e){const t=[];await this.decryptKeys();for(let r of this.decryptedKeys){const i=await(0,c.encryptWithPublicKey)((0,o.base64ToArray)(e),r.privateKey);t.push({publicKey:(0,o.arrayToBase64)(r.publicKey),encPrivateKey:(0,o.jsonToBase64)(i)})}return t}async rotateMemberKeys(e){const t=new Map,r=await(0,c.generateKeyPair)();for(let[i,s]of e)try{const e=await(0,c.encryptWithPublicKey)((0,o.base64ToArray)(s),r.privateKey);t.set(i,[{publicKey:(0,o.arrayToBase64)(r.publicKey),encPrivateKey:(0,o.jsonToBase64)(e)}])}catch(e){throw new a.IncorrectEncryptionKey(e)}return{memberKeys:t,keypair:r}}async processMembership(e,t){const r=new n.Membership(e);if(t&&r.ownerAccess)if(r.__encrypted__)try{const e=await this.encrypter.decrypt(r.ownerAccess);r.ownerAccess=(0,o.base64ToJson)((0,o.arrayToString)(e))}catch(e){throw new a.IncorrectEncryptionKey(e)}else r.ownerAccess=(0,o.base64ToJson)(r.ownerAccess);else r.ownerAccess=void 0;return r}}t.MembershipService=MembershipService},5324:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.retryableErrors=t.throwError=void 0;const i=r(6113),s=r(7002),a=r(4007),n=r(1676),o=r(4441),c=r(8991),u=r(2024),h=r(9849),l=r(5325),p=r(2497),d=r(878),y=r(4771);t.throwError=(e,t,r)=>{switch(e){case 400:throw new s.BadRequest(t,r);case 401:throw new y.Unauthorized(t,r);case 402:throw new h.NotEnoughStorage(t,r);case 403:throw new n.Forbidden(t,r);case 404:throw new l.NotFound(t,r);case 409:throw new a.Conflict(t,r);case 429:throw new d.TooManyRequests(t,r);case 502:throw new i.BadGateway(t,r);case 503:throw new p.ServiceUnavailable(t,r);case 504:throw new o.GatewayTimeout(t,r);default:if(r&&r.code&&("ENOTFOUND"===r.code||"ECONNRESET"===r.code||"ETIMEDOUT"===r.code||"ECONNREFUSED"===r.code||"ESOCKETTIMEOUT"===r.code||"socket hang-up"===r.code))throw new u.NetworkError(r.code,r);throw new c.InternalError("Internal error. Please try again or contact Tusky support.",r)}},t.retryableErrors=[u.NetworkError,i.BadGateway,p.ServiceUnavailable,o.GatewayTimeout]},5325:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotFound=void 0;const i=r(587);class NotFound extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=404}}t.NotFound=NotFound},5334:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBuffers=t.arrayBufferToArray=t.blobToArray=t.dataUrlToArray=t.arrayToDataUrl=t.base64ToJson=t.jsonToBase64=t.stringToArray=t.arrayToString=t.stringToBase64=t.base64ToString=t.base64ToArray=t.arrayToBase64=void 0;const i=r(6661);function arrayToBase64(e){return(0,i.fromByteArray)(new Uint8Array(e))}function arrayToString(e){return(new TextDecoder).decode(e)}function stringToArray(e){return(new TextEncoder).encode(e)}async function blobToArray(e){const t=await new Response(e).arrayBuffer();return new Uint8Array(t)}t.arrayToBase64=arrayToBase64,t.base64ToArray=function base64ToArray(e){return(0,i.toByteArray)(e)},t.arrayToString=arrayToString,t.stringToArray=stringToArray,t.stringToBase64=function stringToBase64(e){return arrayToBase64(stringToArray(e))},t.jsonToBase64=function jsonToBase64(e){const t=JSON.stringify(e);return(0,i.fromByteArray)(stringToArray(t))},t.base64ToJson=function base64ToJson(e){const t=(0,i.toByteArray)(e);return JSON.parse(arrayToString(t))},t.base64ToString=function base64ToString(e){return arrayToString((0,i.toByteArray)(e))},t.arrayToDataUrl=function arrayToDataUrl(e){const t=new Blob([e]);return URL.createObjectURL(t)},t.dataUrlToArray=async function dataUrlToArray(e){const t=await fetch(e);return blobToArray(await t.blob())},t.blobToArray=blobToArray,t.arrayBufferToArray=function arrayBufferToArray(e){const t=Buffer.alloc(e.byteLength),r=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=r[e];return new Uint8Array(t)},t.mergeBuffers=function mergeBuffers(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}},5376:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fileSourceToTusFile=t.tusFileToUint8Array=t.streamToUint8Array=t.pathToReadable=void 0;const s=r(2203),a=r(5325),n=r(7002),o=r(7099),c=r(3288),u=i(r(6928)),h=r(9896);t.pathToReadable=async e=>{if(!(0,h.existsSync)(e))throw new a.NotFound("Could not find a file in your filesystem: "+e);const t=(0,h.statSync)(e),r=u.default.basename(e),i=(0,c.getMimeTypeFromFileName)(r)||o.DEFAULT_FILE_TYPE,s=t.ctime.getTime(),n=t.size,l=(0,h.createReadStream)(e);return l.name=r,l.type=i,l.lastModified=s,l.size=n,l};t.streamToUint8Array=async e=>new Promise(((t,r)=>{const i=[];e.on("data",(e=>i.push(Buffer.from(e)))),e.on("error",(e=>r(e))),e.on("end",(()=>t(Buffer.concat(i))))})).then((e=>new Uint8Array(e))),t.tusFileToUint8Array=async function tusFileToUint8Array(e){if(e instanceof Buffer)return new Uint8Array(e);if(e instanceof s.Readable)return(0,t.streamToUint8Array)(e);throw new n.BadRequest("File source is not supported. Please provide a valid source: web File object, file path, buffer or stream.")},t.fileSourceToTusFile=async function fileSourceToTusFile(e){if(e instanceof Buffer)return e;if(e instanceof s.Readable)return e;if("string"==typeof e)return(0,t.pathToReadable)(e);if(e instanceof ArrayBuffer)return Buffer.from(e);if(e instanceof Uint8Array)return Buffer.from(e);if(e instanceof Blob)return Buffer.from(await e.arrayBuffer());throw new n.BadRequest("File source is not supported. Please provide a valid source: web File object, file path, buffer or stream.")}},5504:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.retry=t.ApiClient=void 0;const s=r(3903),a=r(5324),n=r(7002),o=r(5744),c=r(3491),u=i(r(6713)),h=r(1802),l=r(1377),p=r(7904),d=r(8991);class ApiClient{constructor(){this._meUri="me",this._keysUri="keys",this._vaultUri="vaults",this._fileUri="files",this._folderUri="folders",this._trashUri="trash",this._membershipUri="members",this._apiKeyUri="api-keys",this._storageUri="storage",this._subscriptionUri="subscriptions",this._collectionUri="collections",this._nftUri="nfts",this._sdkVersion="Tusky-SDK/0.27.0-dev.4",this._data={},this._queryParams={},this.addQueryParams=function(e,t){return e+="?"+new URLSearchParams(JSON.parse(JSON.stringify(t))).toString()},this._httpClient=p.httpClient}clone(){const e=new ApiClient;return e._apiUrl=this._apiUrl,e._cdnUrl=this._cdnUrl,e._auth=this._auth,e._resourceId=this._resourceId,e._vaultId=this._vaultId,e._numberOfChunks=this._numberOfChunks,e._encrypted=this._encrypted,e._signature=this._signature,e._digest=this._digest,e._name=this._name,e._description=this._description,e._recipient=this._recipient,e._thumbnailUrl=this._thumbnailUrl,e._projectUrl=this._projectUrl,e._creator=this._creator,e._link=this._link,e._tags=this._tags,e._keys=this._keys,e._address=this._address,e._role=this._role,e._expiresAt=this._expiresAt,e._allowedStorage=this._allowedStorage,e._allowedPaths=this._allowedPaths,e._picture=this._picture,e._trashExpiration=this._trashExpiration,e._publicKey=this._publicKey,e._encPrivateKey=this._encPrivateKey,e._encPrivateKeyBackup=this._encPrivateKeyBackup,e._ownerAccess=this._ownerAccess,e._authProvider=this._authProvider,e._redirectUri=this._redirectUri,e._refreshToken=this._refreshToken,e._authCode=this._authCode,e._grantType=this._grantType,e._status=this._status,e._vaultId=this._vaultId,e._parentId=this._parentId,e._sdkVersion=this._clientName,e._clientName=this._clientName,e._groupId=this._groupId,e._queryParams=this._queryParams,e._progressId=this._progressId,e._progressHook=this._progressHook,e._cancelHook=this._cancelHook,e._totalBytes=this._totalBytes,e._uploadedBytes=this._uploadedBytes,e._publicRoute=this._publicRoute,e}env(e){return this._apiUrl=e.apiUrl,this._cdnUrl=e.cdnUrl,this}auth(e){return this._auth=e,this}resourceId(e){return this._resourceId=e,this}status(e){return this._status=e,this}encrypted(e){return this._encrypted=e,this}publicRoute(e){return this._publicRoute=e,this}keys(e){return this._keys=e,this}description(e){return this._description=e,this}recipient(e){return this._recipient=e,this}thumbnailUrl(e){return this._thumbnailUrl=e,this}projectUrl(e){return this._projectUrl=e,this}creator(e){return this._creator=e,this}link(e){return this._link=e,this}tags(e){return this._tags=e,this}vaultId(e){return this._vaultId=e,this}clientName(e){return this._clientName=e,this}groupId(e){return this._groupId=e,this}signature(e){return this._signature=e,this}parentId(e){return this._parentId=e,this}name(e){return this._name=e,this}role(e){return this._role=e,this}expiresAt(e){return this._expiresAt=e,this}allowedStorage(e){return this._allowedStorage=e,this}allowedPaths(e){return this._allowedPaths=e,this}picture(e){return this._picture=e,this}trashExpiration(e){return this._trashExpiration=e,this}publicKey(e){return this._publicKey=e,this}encPrivateKey(e){return this._encPrivateKey=e,this}encPrivateKeyBackup(e){return this._encPrivateKeyBackup=e,this}ownerAccess(e){return this._ownerAccess=e,this}authProvider(e){return this._authProvider=e,this}redirectUri(e){return this._redirectUri=e,this}refreshToken(e){return this._refreshToken=e,this}authCode(e){return this._authCode=e,this}grantType(e){return this._grantType=e,this}address(e){return this._address=e,this}digest(e){return this._digest=e,this}data(e){return this._data=e,this}queryParams(e){if(e){const t=Object.fromEntries(Object.entries(e).filter((([e,t])=>t)));this._queryParams={...this._queryParams,...t}}else this._queryParams={};return this}totalBytes(e){return this._totalBytes=e,this}loadedBytes(e){return this._uploadedBytes=e,this}progressHook(e,t){return this._progressHook=e,this._progressId=t||(0,s.v4)(),this}cancelHook(e){return this._cancelHook=e,this}numberOfChunks(e){return this._numberOfChunks=e,this}async getMe(){const e=await this.get(`${this._apiUrl}/${this._meUri}`);return new o.User(e)}async updateMe(){if(!(this._name||this._picture||this._encPrivateKey||this._encPrivateKeyBackup))throw new n.BadRequest("Nothing to update.");return this.data({name:this._name,picture:this._picture,encPrivateKey:this._encPrivateKey,encPrivateKeyBackup:this._encPrivateKeyBackup}),this.patch(`${this._apiUrl}/${this._meUri}`)}async createEncryptionKeys(){if(!this._publicKey&&!this._encPrivateKey)throw new n.BadRequest("Nothing to create.");return this.data({publicKey:this._publicKey,encPrivateKey:this._encPrivateKey,encPrivateKeyBackup:this._encPrivateKeyBackup}),this.post(`${this._apiUrl}/${this._meUri}/${this._keysUri}`)}async updateEncryptionKeys(){if(!this._publicKey&&!this._encPrivateKey&&!this._encPrivateKeyBackup)throw new n.BadRequest("Nothing to update.");return this.data({publicKey:this._publicKey,encPrivateKey:this._encPrivateKey,encPrivateKeyBackup:this._encPrivateKeyBackup}),this.patch(`${this._apiUrl}/${this._meUri}/${this._keysUri}`)}async deleteEncryptionKeys(){return this.delete(`${this._apiUrl}/${this._meUri}/${this._keysUri}`)}async getMembers(){return this.get(`${this._apiUrl}/${this._vaultUri}/${this._vaultId}/members`)}async getMemberships(){return this.get(`${this._apiUrl}/${this._membershipUri}`)}async getVaults(){return this.get(`${this._apiUrl}/${this._vaultUri}`)}async getFiles(){return this.get(`${this._apiUrl}/files`)}async getFolders(){return this.get(`${this._apiUrl}/folders`)}async getMembershipsByVaultId(){return this.get(`${this._apiUrl}/${this._vaultUri}/${this._vaultId}/${this._membershipUri}`)}async getFile(){return this.get(`${this._apiUrl}/files/${this._resourceId}`)}async getFolder(){return this.get(`${this._apiUrl}/folders/${this._resourceId}`)}async getMembership(){return this.get(`${this._apiUrl}/${this._vaultUri}/${this._membershipUri}/${this._resourceId}`)}async getVault(){return this.get(`${this._apiUrl}/${this._vaultUri}/${this._resourceId}`)}async getApiKeys(){return this.get(`${this._apiUrl}/${this._apiKeyUri}`)}async generateApiKey(){return this.post(`${this._apiUrl}/${this._apiKeyUri}`)}async revokeApiKey(){return this.delete(`${this._apiUrl}/${this._apiKeyUri}/${this._resourceId}`)}async getCollections(){return this.get(`${this._apiUrl}/${this._collectionUri}`)}async getNfts(){return this.get(`${this._apiUrl}/${this._nftUri}`)}async getNft(){return this.get(`${this._apiUrl}/${this._nftUri}/${this._resourceId}`)}async getCollection(){return this.get(`${this._apiUrl}/${this._collectionUri}/${this._resourceId}`)}async mintNft(){if(!this._name)throw new n.BadRequest("Missing name input. Use ApiClient#name() to add it");return this.data({name:this._name,description:this._description,fileId:this._resourceId,recipient:this._recipient,link:this._link,creator:this._creator,thumbnailUrl:this._thumbnailUrl,projectUrl:this._projectUrl}),this.post(`${this._apiUrl}/${this._nftUri}`)}async mintCollection(){return this.data({description:this._description,folderId:this._resourceId,recipient:this._recipient,link:this._link,creator:this._creator,thumbnailUrl:this._thumbnailUrl,projectUrl:this._projectUrl}),this.post(`${this._apiUrl}/${this._collectionUri}`)}async post(e){return this.fetch("post",e)}async put(e){return this.fetch("put",e)}async patch(e){return this.fetch("patch",e)}async get(e){return this.fetch("get",e)}async delete(e){return this.fetch("delete",e)}async fetch(e,t){const r={method:e,url:this._queryParams?this.addQueryParams(t,this._queryParams):t,headers:{"Content-Type":"application/json",...this.getCustomHeaders(),...this._publicRoute?{}:await this._auth.getAuthorizationHeader()}};return this._data&&(r.data=this._data),l.logger.info(`Request ${r.method}: `+r.url),l.logger.debug(r),await retry((async()=>{try{return(await this._httpClient(r)).data}catch(e){l.logger.debug(r),(0,a.throwError)(e.response?.status,e.response?.data?.msg,e)}}))}async updateFile(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.data({name:this._name,parentId:this._parentId,status:this._status}),this.patch(`${this._apiUrl}/${this._fileUri}/${this._resourceId}`)}async deleteFile(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.delete(`${this._apiUrl}/${this._fileUri}/${this._resourceId}`)}async createFolder(){if(!this._vaultId)throw new n.BadRequest("Missing vault id input. Use ApiClient#vaultId() to add it");if(!this._name)throw new n.BadRequest("Missing name input. Use ApiClient#name() to add it");return this.data({vaultId:this._vaultId,parentId:this._parentId,name:this._name}),this.post(`${this._apiUrl}/${this._folderUri}`)}async createFolderTree(){if(!this._vaultId)throw new n.BadRequest("Missing vault id input. Use ApiClient#vaultId() to add it");if(!this._data)throw new n.BadRequest("Missing name input. Use ApiClient#data() to add it");return this.data({vaultId:this._vaultId,parentId:this._parentId,paths:this._data}),this.post(`${this._apiUrl}/${this._folderUri}/tree`)}async createAuthChallenge(){if(!this._address)throw new n.BadRequest("Missing address input. Use ApiClient#address() to add it");return this.data({address:this._address}),this.post(`${this._apiUrl}/auth/create-challenge`)}async verifyAuthChallenge(){if(!this._address)throw new n.BadRequest("Missing address input. Use ApiClient#address() to add it");if(!this._signature)throw new n.BadRequest("Missing signature input. Use ApiClient#signature() to add it");return this.data({address:this._address,signature:this._signature}),this.post(`${this._apiUrl}/auth/verify-challenge`)}async generateJWT(){if(!this._authProvider)throw new n.BadRequest("Missing authProvider input. Use ApiClient#authProvider() to add it");if(!this._grantType)throw new n.BadRequest("Missing grantType input. Use ApiClient#grantType() to add it");return this.data({authProvider:this._authProvider,grantType:this._grantType,redirectUri:this._redirectUri,code:this._authCode,refreshToken:this._refreshToken}),this.post(`${this._apiUrl}/auth/token`)}async updateFolder(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.data({name:this._name,parentId:this._parentId,status:this._status}),this.patch(`${this._apiUrl}/${this._folderUri}/${this._resourceId}`)}async deleteFolder(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.delete(`${this._apiUrl}/${this._folderUri}/${this._resourceId}`)}async createVault(){if(!this._name)throw new n.BadRequest("Missing name input. Use ApiClient#name() to add it");return this.data({name:this._name,description:this._description,encrypted:this._encrypted,tags:this._tags,keys:this._keys}),this.post(`${this._apiUrl}/${this._vaultUri}`)}async updateVault(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.data({name:this._name,description:this._description,tags:this._tags,status:this._status}),this.patch(`${this._apiUrl}/${this._vaultUri}/${this._resourceId}`)}async deleteVault(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.delete(`${this._apiUrl}/${this._vaultUri}/${this._resourceId}`)}async getTrash(){const e=await this.get(`${this._apiUrl}/${this._trashUri}`);return new c.Folder(e)}async emptyTrash(){const e=await this.delete(`${this._apiUrl}/${this._trashUri}`);return new c.Folder(e)}async createMembership(){if(!this._vaultId)throw new n.BadRequest("Missing address input. Use ApiClient#vaultId() to add it");if(!this._address)throw new n.BadRequest("Missing address input. Use ApiClient#address() to add it");if(!this._role)throw new n.BadRequest("Missing role input. Use ApiClient#role() to add it");return this.data({address:this._address,role:this._role,expiresAt:this._expiresAt,name:this._name,keys:this._keys,encPrivateKey:this._encPrivateKey,ownerAccess:this._ownerAccess,allowedStorage:this._allowedStorage,allowedPaths:this._allowedPaths}),this.post(`${this._apiUrl}/${this._vaultUri}/${this._vaultId}/${this._membershipUri}`)}async updateMembership(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.data({role:this._role,expiresAt:this._expiresAt,status:this._status,keys:this._keys}),this.patch(`${this._apiUrl}/${this._vaultUri}/${this._membershipUri}/${this._resourceId}`)}async deleteMembership(){if(!this._resourceId)throw new n.BadRequest("Missing resource id input. Use ApiClient#resourceId() to add it");return this.data({keys:this._keys}),this.delete(`${this._apiUrl}/${this._vaultUri}/${this._membershipUri}/${this._resourceId}`)}async downloadFile(){if(!this._resourceId)throw new n.BadRequest("Missing resource id to download. Use ApiClient#resourceId() to add it");const e={method:"get",signal:this._cancelHook?this._cancelHook.signal:null,headers:this.getCustomHeaders()},t=`${this._cdnUrl}/${this._resourceId}`;l.logger.info(`Request ${e.method}: `+t);try{return await(0,u.default)(t,e)}catch(e){(0,a.throwError)(e.response?.status,e.response?.data?.msg,e)}}async getStorage(){const e=await this.get(`${this._apiUrl}/${this._storageUri}`);return new h.Storage(e)}getCustomHeaders(){const e={"SDK-Version":this._sdkVersion};return this._clientName&&(e["Client-Name"]=this._clientName),e}}function delay(e){return new Promise((t=>setTimeout(t,e)))}async function retry(e,t=!1,r=5,i=1e3){let s=0;for(;s<r;)try{return await e()}catch(e){if(!t&&!a.retryableErrors.some((t=>e instanceof t)))throw e;if(s++,l.logger.warn(`Retry attempt ${s} failed. Retrying...`),s>=r)throw e;await delay(i)}throw new d.InternalError("Retry attempts exceeded")}t.ApiClient=ApiClient,t.retry=retry},5744:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;const i=r(1802);t.User=class User{constructor(e){this.address=e.address,this.email=e.email,this.name=e.name,this.picture=e.picture,this.publicKey=e.publicKey,this.encPrivateKey=e.encPrivateKey,this.encPrivateKeyBackup=e.encPrivateKeyBackup,this.storage=e.storage?new i.Storage(e.storage):e.storage,this.guest=e.guest}}},5770:e=>{e.exports=require("@aws-amplify/core")},5779:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(9154),s=r(5770),a=r(6379);t.default=class PubSub{constructor(e){this.config=(0,i.apiConfig)(e.env),s.Amplify.configure({API:{GraphQL:{endpoint:this.config.gqlUrl,region:"eu-central-1",defaultAuthMode:"lambda"}}}),this.client=(0,a.generateClient)({authMode:"lambda",authToken:"custom-authorized"})}}},6036:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Notification=void 0;t.Notification=class Notification{constructor(e){this.id=e.id,this.event=e.event,this.channels=e.channels,this.objectId=e.objectId,this.address=e.toAddress,this.createdAt=e.createdAt}}},6113:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BadGateway=void 0;const i=r(587);class BadGateway extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=502}}t.BadGateway=BadGateway},6194:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileModule=void 0;const i=r(7099),s=r(9896),a=r(2203);class NodeFileModule extends i.FileModule{async download(e,t={path:"."}){const r=await this.stream(e);return new Promise(((e,i)=>a.Readable.from(r).pipe((0,s.createWriteStream)(t.path)).on("error",(e=>i(e))).on("finish",(()=>e(t.path)))))}}t.FileModule=NodeFileModule},6219:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TuskyBuilder=void 0;const s=r(9949),a=r(3491),n=r(4164),o=r(1377),c=i(r(1035)),u=i(r(5779)),h=r(781);t.TuskyBuilder=class TuskyBuilder{useOAuth(e){return this._authType="OAuth",this._authConfig=e,this}useWallet(e){return this._authType="Wallet",this._authConfig=e,this}useApiKey(e){return this._authType="ApiKey",this._authConfig={apiKey:e},this}useLogger(e){return this._logger=e.logger?e.logger:new o.ConsoleLogger(e),this}useStorage(e){return this._storage=e,this}useEncrypter(e){return this._encrypterConfig=e,this}useClientName(e){return this._clientName=e,this}useEnv(e){return this._env=e,this}getConfig(){return{auth:this._auth,encrypter:this._encrypter,env:this._env,logger:this._logger,storage:this._storage,clientName:this._clientName}}async build(){this._env=this._env||a.DEFAULT_ENV,this._storage=this._storage||(0,h.defaultStorage)();const e=new n.Auth({...this.getConfig(),...this._authConfig,authType:this._authType}),t=new s.Tusky({...this.getConfig(),auth:e,env:this._env,api:new c.default({...this.getConfig(),auth:e})});return t.pubsub=new u.default({env:this._env}),await t.addEncrypter(this._encrypterConfig),(0,o.setLogger)(this._logger),t}}},6379:e=>{e.exports=require("@aws-amplify/api")},6385:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FolderModule=void 0;const s=r(2640),a=r(7099),n=r(4188),o=r(1388),c=r(6765),u=i(r(2698)),h=r(7276),l=r(7243);function getFolderName(e){const t=e.lastIndexOf("/");return-1!==t?e.substring(t+1):e}function getParentPath(e){const t=e.lastIndexOf("/");return-1!==t?e.substring(0,t):null}t.FolderModule=class FolderModule{constructor(e){this.defaultCreateOptions={parentId:void 0},this.defaultUploadOptions={parentId:void 0,includeRootFolder:!1,withFiles:!1,skipHidden:!0},this.defaultListOptions={shouldDecrypt:!0},this.defaultGetOptions={shouldDecrypt:!0},this.service=new c.FolderService(e),this.auth=e.auth}async create(e,t,r=this.defaultCreateOptions){await this.service.setVaultContext(e),await this.service.setName(t),this.service.setParentId(r.parentId);const i=await this.service.api.createFolder({vaultId:e,name:this.service.name,parentId:this.service.parentId});return this.service.processFolder(i,this.service.encrypted,this.service.keys)}async upload(e,t,r=this.defaultUploadOptions){const i=await(0,h.traverse)(t,r.includeRootFolder,r.skipHidden),s=i.filter((e=>e.isFolder)).map((e=>e.relativePath)),{folderIdMap:n}=await this.createTree(e,s,r),o=(0,u.default)(10),c=i.filter((e=>!e.isFolder)).map((t=>o((()=>new a.FileModule({...this.service,auth:this.auth}).upload(e,t.fullPath,{name:t.name,parentId:n[t.parentPath]||r.parentId||e})))));return await Promise.all(c),{folderIdMap:n}}async createTree(e,t,r=this.defaultUploadOptions){await this.service.setVaultContext(e),this.service.setParentId(r.parentId);const i=await Promise.all(t.filter((e=>e)).map((e=>({relativePath:e,parentPath:getParentPath(e),name:getFolderName(e)}))).sort(((e,t)=>e.relativePath.split("/").length-t.relativePath.split("/").length)).filter((e=>!r.skipHidden||!e.name.startsWith(".")))),s=await Promise.all(i.map((async e=>({name:await this.service.processWriteString(e.name),parentPath:this.service.encrypted?await(0,l.digest)(e.parentPath):e.parentPath,relativePath:this.service.encrypted?await(0,l.digest)(e.relativePath):e.relativePath}))));let a=(await this.service.api.createFolderTree({vaultId:e,parentId:r.parentId,paths:s})).folderIdMap;if(this.service.encrypted){const e={};for(let t of i){const r=await(0,l.digest)(t.relativePath);e[t.relativePath]=a[r]}return{folderIdMap:e}}return{folderIdMap:a}}async get(e,t=this.defaultGetOptions){const r={...this.defaultGetOptions,...t},i=await this.service.api.getFolder(e);return this.service.processFolder(i,r.shouldDecrypt)}async list(e=this.defaultListOptions){(0,n.validateListPaginatedApiOptions)(e);const t={...this.defaultListOptions,...e},r=await this.service.api.getFolders(t),i=[],s=[];return await(0,o.processListItems)(r.items,(async e=>{try{const r=await this.service.processFolder(e,t.shouldDecrypt);i.push(r)}catch(t){s.push({id:e.id,error:t})}})),{items:i,nextToken:r.nextToken,errors:s}}async listAll(e=this.defaultListOptions){return(0,o.paginate)((async e=>this.list(e)),e)}async rename(e,t){await this.service.setVaultContextFromNodeId(e),await this.service.setName(t);const r=await this.service.api.updateFolder({id:e,name:this.service.name});return this.service.processFolder(r,!0)}async move(e,t){await this.service.setVaultContextFromNodeId(e);const r=await this.service.api.updateFolder({id:e,parentId:t||this.service.vaultId});return this.service.processFolder(r,!0)}async delete(e){return this.service.api.updateFolder({id:e,status:s.status.DELETED})}async restore(e){return this.service.api.updateFolder({id:e,status:s.status.ACTIVE})}async deletePermanently(e){return this.service.api.deleteFolder(e)}}},6408:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IncorrectEncryptionKey=void 0;const i=r(587);class IncorrectEncryptionKey extends i.TuskyError{constructor(e){super("Incorrect encryption key.",e),this.statusCode=409}}t.IncorrectEncryptionKey=IncorrectEncryptionKey},6445:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamConverter=void 0;const i=r(9606);t.StreamConverter=class StreamConverter{static async toArrayBuffer(e){const t=e.getReader(),r=[];let i=await t.read();for(;!i.done;)r.push(i.value),i=await t.read();const s=r.reduce(((e,t)=>e+t.length),0),a=new Uint8Array(s);let n=0;for(const e of r)a.set(e,n),n+=e.length;return a.buffer}static async fromArrayBuffer(e){return new i.ReadableStream({start(t){const r=new DataView(e);let i=0;for(;i<e.byteLength;)t.enqueue(r.getUint8(i)),i++;t.close()}})}static fromAsyncIterable(e){return new i.ReadableStream({start(t){let r=0;!async function pushData(){for await(const i of e){const e=i;t.enqueue(e),r+=e.length}t.close()}()}})}}},6527:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth=t.authProviderConfig=void 0;const i=r(865),s=r(9920),a=r(7002),n=r(1377),o=r(1035),c=r(4771),u=r(781),h=r(1984),l=r(5504),p=r(5324);t.authProviderConfig=e=>({Google:{CLIENT_ID:e===h.Envs.PROD?"426736059844-ut21sgi6j7fhai51hlk9nq1785198tcq.apps.googleusercontent.com":"426736059844-2o0vvj882fvvris0kqpfuh1vi47js7he.apps.googleusercontent.com",AUTH_URL:"https://accounts.google.com/o/oauth2/v2/auth",SCOPES:"openid email profile"},Twitch:{CLIENT_ID:e===h.Envs.PROD?"zjvek40acgbaade27yrwdsvsslx0e4":"6h9wlqcwu01ve4al9qs04zeul7znj7",AUTH_URL:"https://id.twitch.tv/oauth2/authorize",SCOPES:"openid user:read:email"}});t.OAuth=class OAuth{constructor(e){if(!e.authProvider)throw new a.BadRequest("Missing auth provider, please provide in the OAuth config.");if(this.env=e.env,this.authProviderConfig=(0,t.authProviderConfig)(e.env)[e.authProvider],!this.authProviderConfig)throw new a.BadRequest("Unsupported authProvider, valid providers: "+Object.keys((0,t.authProviderConfig)(e.env)).join(", "));this.redirectUri=e.redirectUri,this.authProvider=e.authProvider,this.storage=e.storage||(0,u.defaultStorage)(),this.jwtClient=new u.JWTClient({storage:this.storage,env:this.env}),this.enokiClient=new s.EnokiClient({env:e.env})}async initOAuthFlow(){const e=await this.createAuthorizationUrl();window.location.href=e}async handleOAuthCallback(){const e=window.location.search,t=new URLSearchParams(e).get("code");if(t){n.logger.info("Authorization Code:"+t),await this.exchangeCodeForTokens(t);const{address:e}=await(0,l.retry)((async()=>{try{return this.enokiClient.getZkLogin(this.jwtClient.getIdToken())}catch(e){(0,p.throwError)(e.response?.status,e.response?.data?.msg,e)}}));return this.jwtClient.setAddress(e),{address:e}}n.logger.warn("Authorization code not found.")}async exchangeCodeForTokens(e){try{if(!this.redirectUri)throw new a.BadRequest("Missing redirect uri, please provide your app auth callback URL.");const{idToken:t,accessToken:r,refreshToken:i}=await new o.TuskyApi({env:this.env}).generateJWT({authProvider:this.authProvider,grantType:"code",redirectUri:this.redirectUri,authCode:e});this.jwtClient.setAccessToken(r),this.jwtClient.setRefreshToken(i),this.jwtClient.setIdToken(t)}catch(e){n.logger.error(e)}}async createAuthorizationUrl(){const e=new i.Ed25519Keypair,t=await(0,l.retry)((async()=>{try{return this.enokiClient.createZkLoginNonce(e)}catch(e){(0,p.throwError)(e.response?.status,e.response?.data?.msg,e)}}));if(!this.redirectUri)throw new a.BadRequest("Missing redirect uri, please provide your app auth callback URL.");const r=new URLSearchParams({nonce:t.nonce,client_id:this.authProviderConfig.CLIENT_ID,redirect_uri:this.redirectUri,response_type:"code",scope:this.authProviderConfig.SCOPES,access_type:"offline",prompt:"consent"});return`${this.authProviderConfig.AUTH_URL}?${r}`}async refreshTokens(){if(!this.jwtClient.getRefreshInProgress()){this.jwtClient.setRefreshInProgress(!0);try{const e=this.jwtClient.getRefreshToken();if(!e)throw new c.Unauthorized("Session expired. Please log in again.");const t=await new o.TuskyApi({env:this.env}).generateJWT({authProvider:this.authProvider,grantType:"refreshToken",refreshToken:e});if(!t||!t.accessToken||!t.idToken)throw new c.Unauthorized("Invalid session. Please log in again.");this.jwtClient.setAccessToken(t.accessToken),this.jwtClient.setIdToken(t.idToken),t.refreshToken&&this.jwtClient.setRefreshToken(t.refreshToken),this.jwtClient.setRefreshInProgress(!1)}catch(e){throw n.logger.error(e),this.jwtClient.setRefreshInProgress(!1),new c.Unauthorized("Failed to refresh tokens.")}}}}},6599:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformStream=t.StreamSlicer=t.DecryptStreamController=void 0;const i=r(9606),s=r(7604),a=r(1377);t.DecryptStreamController=class DecryptStreamController{constructor(e,t=0,r,i){this.key=e,this.index=t,this.files=i,r&&(this.file=this.files.get(r))}async transform(e,t){const r=e.slice(0,s.IV_LENGTH_IN_BYTES),i=e.slice(s.IV_LENGTH_IN_BYTES);try{const e=await(0,s.decryptAes)({iv:r,ciphertext:i},this.key);t.enqueue(new Uint8Array(e)),this.file&&(this.file.progress+=e.byteLength,this.files.set(this.file.id,this.file)),this.index+=1}catch(e){a.logger.error(e)}}};t.StreamSlicer=class StreamSlicer{constructor(e,t){this.mode=t,this.rs=e,this.chunkSize=e,this.partialChunk=new Uint8Array(this.chunkSize),this.offset=0}send(e,t){t.enqueue(e),21===this.chunkSize&&"decrypt"===this.mode&&(this.chunkSize=this.rs),this.partialChunk=new Uint8Array(this.chunkSize),this.offset=0}transform(e,t){let r=0;if(this.offset>0){const i=Math.min(e.byteLength,this.chunkSize-this.offset);this.partialChunk.set(e.slice(0,i),this.offset),this.offset+=i,r+=i,this.offset===this.chunkSize&&this.send(this.partialChunk,t)}for(;r<e.byteLength;){const i=e.byteLength-r;if(i>=this.chunkSize){const i=e.slice(r,r+this.chunkSize);r+=this.chunkSize,this.send(i,t)}else{const t=e.slice(r,r+i);r+=t.byteLength,this.partialChunk.set(t),this.offset=t.byteLength}}}flush(e){this.offset>0&&e.enqueue(this.partialChunk.slice(0,this.offset))}},t.transformStream=function transformStream(e,t,r){try{return e.pipeThrough(new i.TransformStream(t))}catch(s){const a=e.getReader?e.getReader():e;return new i.ReadableStream({start(e){if(t.start)return t.start(e)},async pull(e){let r=!1;const i={enqueue(t){r=!0,e.enqueue(t)}};for(;!r;){const r=await a.read();if(r.done)return t.flush&&await t.flush(e),e.close();await t.transform(r.value,i)}},cancel(e){a.cancel(e),r&&r(e)}})}}},6661:e=>{e.exports=require("base64-js")},6705:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VaultModule=void 0;const n=r(2640),o=r(4188),c=r(1388),u=r(5201),h=r(3453),l=r(7243),p=r(3491),d=r(865),y=r(2988),_=a(r(194)),g=r(1911),f=n.role.VIEWER;t.VaultModule=class VaultModule{constructor(e){this.defaultListOptions={shouldDecrypt:!0},this.defaultGetOptions={shouldDecrypt:!0,deep:!1},this.defaultCreateOptions={encrypted:!0,description:void 0},this.service=new h.VaultService(e)}async get(e,t=this.defaultGetOptions){const r={...this.defaultGetOptions,...t},i=await this.service.api.getVault(e,r);return this.service.processVault(i,i.encrypted&&r.shouldDecrypt,i.__keys__)}async list(e=this.defaultListOptions){(0,o.validateListPaginatedApiOptions)(e);const t={...this.defaultListOptions,...e},r=await this.service.api.getVaults(t),i=[],s=[];return await(0,c.processListItems)(r.items,(async e=>{try{const r=await this.service.processVault(e,t.shouldDecrypt,e.keys);i.push(r)}catch(t){s.push({id:e.id,error:t})}})),{items:i,nextToken:r.nextToken,errors:s}}async listAll(e=this.defaultListOptions){return(0,c.paginate)((async e=>this.list(e)),e)}async create(e,t=this.defaultCreateOptions){const r={...this.defaultCreateOptions,...t};this.service.setEncrypted(r.encrypted);if(new u.MembershipService(this.service).setVaultId(this.service.vaultId),this.service.encrypted){const e=await(0,l.generateKeyPair)();this.service.setDecryptedKeys([{publicKey:e.publicKey,privateKey:e.privateKey}]);const t=await this.service.encrypter.encrypt(e.privateKey),r=[{publicKey:(0,l.arrayToBase64)(e.publicKey),encPrivateKey:t}];this.service.setKeys(r)}await this.service.setName(e),r.description&&await this.service.setDescription(r.description);const i=await this.service.api.createVault({name:this.service.name,description:this.service.description,encrypted:this.service.encrypted,tags:r.tags,keys:this.service.keys});return this.service.processVault(i,!0,this.service.keys)}async rename(e,t){await this.service.setVaultContext(e),await this.service.setName(t);const r=await this.service.api.updateVault({id:e,name:this.service.name});return this.service.processVault(r,!0,this.service.keys)}async update(e,t){await this.service.setVaultContext(e),t.name&&await this.service.setName(t.name),t.description&&await this.service.setDescription(t.description);const r=await this.service.api.updateVault({id:e,name:this.service.name,description:this.service.description,tags:t.tags});return this.service.processVault(r,!0,this.service.keys)}async delete(e){return this.service.api.deleteVault(e)}async airdropAccess(e,t={role:f}){await this.service.setVaultContext(e);const r=new u.MembershipService(this.service);r.setVaultId(this.service.vaultId);const i=new d.Ed25519Keypair;let s,a,n,o,c={identityPrivateKey:i.getSecretKey()};if(this.service.encrypted){t.password?n=t.password:(n=function generateRandomPassword(){const e=(0,g.randomBytes)(32);return _.secureMask.apply(e).password}(),c.password=n),o=await this.service.encrypter.encrypt((0,l.jsonToBase64)(c));const{encPrivateKey:e,keypair:i}=await(new y.UserEncryption).setupPassword(n,!1);a=e,s=await r.prepareMemberKeys((0,l.arrayToBase64)(i.publicKey))}else o=(0,l.jsonToBase64)(c);const h=await this.service.api.createMembership({vaultId:e,address:i.toSuiAddress(),allowedStorage:t.allowedStorage,allowedPaths:t.allowedPaths,expiresAt:t.expiresAt,name:t.name,role:t.role||f,keys:s,encPrivateKey:a,ownerAccess:o});return{identityPrivateKey:i.getSecretKey(),password:n,membership:await r.processMembership(h,this.service.vault.owner===this.service.address)}}async revokeAccess(e){const t=new u.MembershipService(this.service);await t.setVaultContextFromMembershipId(e),await this.service.api.deleteMembership({id:e})}async changeAccess(e,t){const r=await this.service.api.updateMembership({id:e,role:t});return new p.Membership(r)}async members(e){const t=await(0,c.paginate)((async e=>this.service.api.getMembers(e.vaultId)),{vaultId:e});await this.service.setVaultContext(e);const r=new u.MembershipService(this.service);return Promise.all(t?.map((async e=>r.processMembership(e,this.service.vault.owner===this.service.address))))}}},6713:e=>{e.exports=require("cross-fetch")},6765:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FolderService=void 0;const i=r(3410),s=r(6408),a=r(3491),n=r(2640);class FolderService extends i.Service{constructor(e){super(e),this.type=n.objects.FOLDER}async setVaultContextFromNodeId(e){const t=await this.api.getFolder(e),r=await this.api.getVault(t.vaultId);this.setVault(r),this.setVaultId(t.vaultId),this.setEncrypted(t.__encrypted__),await this.setMembershipKeys(t),this.setObject(t),this.setObjectId(e)}async processFolder(e,t,r){const i=new a.Folder(e,r);if(await this.isEncrypted(i)&&t)try{await i.decrypt(this.encrypter)}catch(e){throw new s.IncorrectEncryptionKey(e)}return i}async setName(e){this.name=await this.processWriteString(e)}async isEncrypted(e){return e.vaultId&&e.__encrypted__}}t.FolderService=FolderService},6928:t=>{t.exports=e(import.meta.url)("path")},6957:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CacheBusters=void 0;const i=r(573);class CacheBusters{}t.CacheBusters=CacheBusters,CacheBusters.profile=new i.Subject,CacheBusters.vaults=new i.Subject},7002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BadRequest=void 0;const i=r(587);class BadRequest extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=400}}t.BadRequest=BadRequest},7099:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FileModule=t.onUpdateFile=t.UPLOAD_COOKIE_SESSION_NAME=t.EMPTY_FILE_ERROR_MESSAGE=t.UPLOADER_SERVER_MAX_CONNECTIONS_PER_CLIENT=t.ENCRYPTED_CHUNK_SIZE_IN_BYTES=t.CHUNK_SIZE_IN_BYTES=t.BYTES_IN_MB=t.DEFAULT_FILE_NAME=t.DEFAULT_FILE_TYPE=void 0;const n=r(5376),o=r(2640),c=r(7002),u=r(6445),h=r(3491),l=r(4188),p=r(1388),d=r(7223),y=r(7604),_=a(r(236)),g=r(6408),f=r(9019),v=r(1157);t.DEFAULT_FILE_TYPE="text/plain",t.DEFAULT_FILE_NAME="unnamed",t.BYTES_IN_MB=1e6,t.CHUNK_SIZE_IN_BYTES=5*t.BYTES_IN_MB,t.ENCRYPTED_CHUNK_SIZE_IN_BYTES=t.CHUNK_SIZE_IN_BYTES+y.AUTH_TAG_LENGTH_IN_BYTES+y.IV_LENGTH_IN_BYTES,t.UPLOADER_SERVER_MAX_CONNECTIONS_PER_CLIENT=20,t.EMPTY_FILE_ERROR_MESSAGE="Cannot upload an empty file",t.UPLOAD_COOKIE_SESSION_NAME="tusky.upload.session.id";t.FileModule=class FileModule{constructor(e){this.contentType=null,this.defaultListOptions={shouldDecrypt:!0,parentId:void 0},this.defaultGetOptions={shouldDecrypt:!0},this.defaultCreateOptions={parentId:void 0},this.service=new d.FileService(e),this.auth=e.auth}async uploader(e,r=null,i={}){const s=await this.service.api.getVault(e);let a=null;if(r&&(a=await(0,n.fileSourceToTusFile)(r),0===a.size))throw new c.BadRequest(t.EMPTY_FILE_ERROR_MESSAGE);let o=null;return new _.Upload(a,{endpoint:`${this.service.api.config.apiUrl}/uploads`,retryDelays:[0,500,2e3,5e3],metadata:{vaultId:e,parentId:i?.parentId||e,filename:i?.name||a?.name||t.DEFAULT_FILE_NAME,filetype:i?.mimeType||a?.type||t.DEFAULT_FILE_TYPE},uploadDataDuringCreation:!0,parallelUploads:1,chunkSize:t.CHUNK_SIZE_IN_BYTES,headers:{...await this.auth.getAuthorizationHeader()},httpStack:new f.EncryptableHttpStack(new _.DefaultHttpStack({}),s,this.service.encrypter),removeFingerprintOnSuccess:!0,onBeforeRequest:async e=>{if("POST"===e.getMethod()||"PATCH"===e.getMethod()){const r=e.getUnderlyingObject();r?r.withCredentials=!0:o&&e.setHeader("Cookie",`${t.UPLOAD_COOKIE_SESSION_NAME}=${o}`)}},onAfterResponse:(e,t)=>{t.getHeader("Location")&&(o=t.getHeader("Location").split("/").pop())},onError:i.onError,onProgress:i.onProgress,onSuccess:i.onSuccess})}async upload(e,t,r={}){const i=await this.uploader(e,t,r);await new Promise(((e,t)=>{i.options.onSuccess=()=>{r.onSuccess&&r.onSuccess(),e()},i.options.onError=e=>{r.onError&&r.onError(e),t(e)},i.start()}));return i.url.split("/").pop()}async get(e,t=this.defaultGetOptions){const r={...this.defaultGetOptions,...t},i=await this.service.api.getFile(e);return this.service.processFile(i,r.shouldDecrypt)}async list(e=(this.defaultListOptions=this.defaultListOptions)){(0,l.validateListPaginatedApiOptions)(e);const t={...this.defaultListOptions,...e},r=await this.service.api.getFiles(t),i=[],s=[];return await(0,p.processListItems)(r.items,(async e=>{try{const r=await this.service.processFile(e,t.shouldDecrypt);i.push(r)}catch(t){s.push({id:e.id,error:t})}})),{items:i,nextToken:r.nextToken,errors:s}}async listAll(e=this.defaultListOptions){return(0,p.paginate)((async e=>this.list(e)),e)}async rename(e,t){await this.service.setVaultContextFromNodeId(e),await this.service.setName(t);const r=await this.service.api.updateFile({id:e,name:this.service.name});return this.service.processFile(r,!0)}async move(e,t){return await this.service.setVaultContextFromNodeId(e),this.service.api.updateFile({id:e,parentId:t||this.service.vaultId})}async delete(e){return this.service.api.updateFile({id:e,status:o.status.DELETED})}async restore(e){return this.service.api.updateFile({id:e,status:o.status.ACTIVE})}async deletePermanently(e){return this.service.api.deleteFile(e)}async stream(e){const t=await this.service.api.downloadFile(e,{responseType:"stream"}),r=new h.File(await this.service.api.getFile(e));let i;if(this.service.setEncrypted(r.__encrypted__),this.service.encrypted){const s=await this.aesKey(e);i=await(0,y.decryptStream)(t,s,r.chunkSize)}else i=t;return i}async arrayBuffer(e){const t=await this.stream(e);return u.StreamConverter.toArrayBuffer(t)}async subscribe(e,r,i){await this.service.setVaultContext(e);const s=this.service.keys,a=this.service.encrypter,n=this.service.encrypted;return this.service.pubsub.client.graphql({query:t.onUpdateFile,variables:{filter:{vaultId:{eq:e}}}}).subscribe({next:async({data:e})=>{const t=e.onUpdateFile;if(t&&r){const e=new h.File(t,s);n&&await e.decrypt(a),await r(e)}},error:e=>{i&&i(e)}})}async aesKey(e){const t=await this.get(e);if(!t.encryptedAesKey)return null;if(!t.encryptedAesKey)throw new g.IncorrectEncryptionKey(new Error("Missing file encryption context."));const r=new v.VaultEncryption({vaultKeys:t.__keys__,userEncrypter:this.service.encrypter});return await r.decryptAesKey(t.encryptedAesKey)}},t.onUpdateFile="subscription OnUpdateFile($filter: ModelSubscriptionFileFilterInput) {\n  onUpdateFile(filter: $filter) {\n    id\n    owner\n    vaultId\n    parentId\n    uploadId\n    partition\n    name\n    size\n    status\n    chunkSize\n    numberOfChunks\n    storedEpoch\n    blobId\n    ref\n    erasureCodeType\n    certifiedEpoch\n    mimeType\n    encryptedAesKey\n    expiresAt\n    createdAt\n    updatedAt\n    __typename\n  }\n}\n"},7205:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApiKey=void 0;t.ApiKey=class ApiKey{constructor(e){this.key=e.key,this.address=e.address,this.expiresAt=e.expiresAt,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.status=e.status}}},7223:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileService=void 0;const i=r(3410),s=r(6408),a=r(3491),n=r(2640);class FileService extends i.Service{constructor(e){super(e),this.type=n.objects.FILE}async setVaultContextFromNodeId(e){const t=await this.api.getFile(e),r=await this.api.getVault(t.vaultId);this.setVault(r),this.setVaultId(t.vaultId),this.setEncrypted(t.__encrypted__),await this.setMembershipKeys(t),this.setObject(t),this.setObjectId(e)}async processFile(e,t,r){const i=new a.File(e,r);if(await this.isEncrypted(i)&&t)try{await i.decrypt(this.encrypter)}catch(e){throw new s.IncorrectEncryptionKey(e)}return i}async isEncrypted(e){return e.vaultId&&e.__encrypted__}async setName(e){this.name=await this.processWriteString(e)}}t.FileService=FileService},7243:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(4615),s(r(3770),t),s(r(5334),t),s(r(7449),t),s(r(7604),t),s(r(8072),t),s(r(1608),t)},7276:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traverse=void 0;const i=r(9896),s=r(6928),a=r(7002);t.traverse=(e,r=!1,n=!0,o=e)=>{if("string"!=typeof e)throw new a.BadRequest("Only string folder path supported for node.");const c=[];if((0,i.lstatSync)(e).isFile())return c.push({fullPath:e,relativePath:(0,s.basename)(e),parentPath:null,name:(0,s.basename)(e),isFolder:!1}),c;{const a=(0,i.readdirSync)(e);r&&c.push({fullPath:e,relativePath:(0,s.basename)(e),parentPath:null,name:(0,s.basename)(e),isFolder:!0});for(const u of a){const a=(0,s.join)(e,u),h=(0,s.relative)(o,a),l=(0,s.basename)(h);if(n&&l.startsWith("."))continue;const p=r&&"."===(0,s.dirname)(h)?(0,s.basename)(e):(0,s.dirname)(h);(0,i.lstatSync)(a).isDirectory()?(c.push({fullPath:a,relativePath:h,parentPath:p,name:l,isFolder:!0}),c.push(...(0,t.traverse)(a,!1,n,o))):c.push({fullPath:a,relativePath:h,parentPath:p,name:l,isFolder:!1})}return c}}},7313:e=>{e.exports=require("@mysten/sui/cryptography")},7449:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(325),t)},7604:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeAesPayload=t.decryptStream=t.decryptWithPrivateKey=t.encryptWithPublicKey=t.generateKeyPair=t.generateKey=t.deriveAesKey=t.decryptAes=t.encryptAes=t.signString=t.signHash=t.chainDigest=t.initDigest=t.digestRaw=t.digest=t.importKeyFromSeed=t.importKeyFromBase64=t.exportKeyToBase64=t.importKeyFromArray=t.exportKeyToArray=t.IV_LENGTH_IN_BYTES=t.AUTH_TAG_LENGTH_IN_BYTES=t.KEY_DERIVATION_ITERATION_COUNT=void 0;const s=r(9615),a=r(5334),n=i(r(1331)),o=r(1377),c=r(6599),u=r(6408),h="SHA-256",l="AES-GCM",p=256,d="PBKDF2";async function exportKeyToArray(e){try{const t=await crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto key export error."))}}async function importKeyFromArray(e,t=!1){try{return await crypto.subtle.importKey("raw",e,{name:l,length:p},t,["encrypt","decrypt"])}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto key import error."))}}async function signHash(e,t){const r=new Uint8Array(e);await s.ready;const i=(0,s.crypto_sign_detached)(r,t);return(0,a.arrayToBase64)(i)}async function digestRaw(e){const t=await crypto.subtle.digest(h,e);return(0,a.arrayToBase64)(t)}function decodeAesPayload(e){const t=(0,a.base64ToJson)(e);return{ciphertext:(0,a.base64ToArray)(t.ciphertext),iv:(0,a.base64ToArray)(t.iv)}}t.KEY_DERIVATION_ITERATION_COUNT=1e6,t.AUTH_TAG_LENGTH_IN_BYTES=16,t.IV_LENGTH_IN_BYTES=12,t.exportKeyToBase64=async function exportKeyToBase64(e){const t=await exportKeyToArray(e);return(0,a.arrayToBase64)(t)},t.exportKeyToArray=exportKeyToArray,t.importKeyFromBase64=async function importKeyFromBase64(e,t=!1){return importKeyFromArray((0,a.base64ToArray)(e),t)},t.importKeyFromArray=importKeyFromArray,t.importKeyFromSeed=async function importKeyFromSeed(e){try{const t=await crypto.subtle.digest(h,e);return await crypto.subtle.importKey("raw",t,{name:l,length:p},!1,["encrypt","decrypt"])}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto key import error."))}},t.signHash=signHash,t.digest=async function digest(e){return digestRaw((0,a.stringToArray)(e))},t.digestRaw=digestRaw,t.initDigest=function initDigest(){return new n.default(h,"UINT8ARRAY")},t.chainDigest=function chainDigest(e,t){return e.update(t)},t.signString=async function signString(e,t){const r=await crypto.subtle.digest(h,(0,a.stringToArray)(e));return await signHash(r,t)},t.encryptAes=async function encryptAes(e,r,i=!0){try{const s=crypto.getRandomValues(new Uint8Array(t.IV_LENGTH_IN_BYTES));let n=await crypto.subtle.encrypt({name:l,iv:s},r,e);if(i)return function encodeAesPayload(e,t){const r={ciphertext:(0,a.arrayToBase64)(e),iv:(0,a.arrayToBase64)(t)};return(0,a.jsonToBase64)(r)}(n,s);const o=new Uint8Array(s.length+n.byteLength);return o.set(s,0),o.set(new Uint8Array(n),s.length),o}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto encryption error."))}},t.decryptAes=async function decryptAes(e,t){try{const r=e?.ciphertext?e:decodeAesPayload(e);return await crypto.subtle.decrypt({name:l,iv:r.iv},t,r.ciphertext)}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto decryption error."))}},t.decodeAesPayload=decodeAesPayload,t.deriveAesKey=async function deriveAesKey(e,r,i=t.KEY_DERIVATION_ITERATION_COUNT){try{const t=await crypto.subtle.importKey("raw",(0,a.stringToArray)(e),d,!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:d,salt:r,iterations:i,hash:h},t,{name:l,length:p},!0,["encrypt","decrypt"])}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto key derivation error."))}},t.generateKey=async function generateKey(e=!1){try{return await crypto.subtle.generateKey({name:l,length:p},e,["encrypt","decrypt"])}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Web Crypto key generation error."))}},t.generateKeyPair=async function generateKeyPair(){try{await s.ready;return(0,s.crypto_box_keypair)()}catch(e){throw o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Sodium box key pair generation error."))}},t.encryptWithPublicKey=async function encryptWithPublicKey(e,t){try{await s.ready;const r=(0,s.crypto_box_keypair)(),i=(0,s.randombytes_buf)(s.crypto_box_NONCEBYTES),n=(0,s.crypto_box_easy)(t,i,e,r.privateKey);return{ciphertext:(0,a.arrayToBase64)(n),ephemPublicKey:(0,a.arrayToBase64)(r.publicKey),nonce:(0,a.arrayToBase64)(i),publicKey:(0,a.arrayToBase64)(e)}}catch(r){throw o.logger.debug(e),o.logger.debug(t),o.logger.error(r),new u.IncorrectEncryptionKey(new Error("Sodium encryption error."))}},t.decryptWithPrivateKey=async function decryptWithPrivateKey(e,t){try{await s.ready;return(0,s.crypto_box_open_easy)((0,a.base64ToArray)(t.ciphertext),(0,a.base64ToArray)(t.nonce),(0,a.base64ToArray)(t.ephemPublicKey),e)}catch(e){throw o.logger.debug(t),o.logger.error(e),new u.IncorrectEncryptionKey(new Error("Sodium decryption error."))}},t.decryptStream=async function decryptStream(e,t,r){if(null===e)return null;try{const i=(0,c.transformStream)(e,new c.StreamSlicer(r));return(0,c.transformStream)(i,new c.DecryptStreamController(t))}catch(e){o.logger.error(e)}return null}},7729:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=t.Tusky=void 0;const a=r(9949);Object.defineProperty(t,"Tusky",{enumerable:!0,get:function(){return a.Tusky}});const n=r(4164);Object.defineProperty(t,"Auth",{enumerable:!0,get:function(){return n.Auth}}),s(r(3491),t),s(r(7243),t)},7901:e=>{e.exports=require("agentkeepalive")},7904:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpClient=void 0;const s=i(r(7901)),a=s.default.HttpsAgent,n=i(r(8938)),o=new s.default({maxSockets:160,maxFreeSockets:160,timeout:6e4,freeSocketTimeout:3e4,keepAliveMsecs:6e4}),c=new a({maxSockets:160,maxFreeSockets:160,timeout:6e4,freeSocketTimeout:3e4,keepAliveMsecs:6e4});t.httpClient=n.default.create({httpAgent:o,httpsAgent:c})},8072:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.X25519KeyPair=void 0;const i=r(4855),s=r(1911);class X25519KeyPair{constructor(e){e?(this.privateKey=e,this.publicKey=i.x25519.getPublicKey(e)):(this.privateKey=i.x25519.utils.randomPrivateKey(),this.publicKey=i.x25519.getPublicKey(this.privateKey))}getPrivateKey(){return this.privateKey}getPublicKey(){return this.publicKey}getPrivateKeyHex(){return(0,s.bytesToHex)(this.privateKey)}getPublicKeyHex(){return(0,s.bytesToHex)(this.publicKey)}static fromPrivateKeyHex(e){const t=(0,s.hexToBytes)(e);return new X25519KeyPair(t)}}t.X25519KeyPair=X25519KeyPair},8082:e=>{e.exports=require("@esm2cjs/p-queue")},8191:e=>{e.exports=require("bip39")},8495:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var s,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(n=(a<3?s(n):a>3?s(t,r,n):s(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Folder=void 0;const s=r(7243);class Folder extends s.Encryptable{constructor(e,t){super(t||e.__keys__),this.id=e.id,this.owner=e.owner,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.type=e.type,this.size=e.size,this.name=e.name,this.status=e.status,this.vaultId=e.vaultId,this.parentId=e.parentId,this.__encrypted__=e.__encrypted__}}t.Folder=Folder,i([(0,s.encrypted)()],Folder.prototype,"name",void 0)},8787:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApiKeyModule=void 0;const i=r(7205),s=r(1388),a=r(3410);t.ApiKeyModule=class ApiKeyModule{constructor(e){this.service=new a.Service(e)}async listAll(){return(0,s.paginate)((async()=>this.list()),{})}async list(){const e=await this.service.api.getApiKeys();return{items:e.items?.map((e=>new i.ApiKey(e))),nextToken:e.nextToken,errors:e.errors}}async generate(){return new i.ApiKey(await this.service.api.generateApiKey())}async revoke(e){return new i.ApiKey(await this.service.api.revokeApiKey(e))}}},8938:e=>{e.exports=require("axios")},8991:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InternalError=void 0;const i=r(587);class InternalError extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=500}}t.InternalError=InternalError},9019:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptableHttpStack=t.UPLOAD_METADATA_FILENAME_KEY=t.UPLOAD_METADATA_ENCRYPTED_AES_KEY_KEY=t.UPLOAD_METADATA_NUMBER_OF_CHUNKS_KEY=t.UPLOAD_METADATA_CHUNK_SIZE_KEY=t.UPLOAD_METADATA_HEADER=t.UPLOAD_OFFSET_HEADER=t.UPLOAD_LENGTH_HEADER=t.CONTENT_LENGTH_HEADER=void 0;const i=r(5376),s=r(7243),a=r(7099),n=r(7604),o=r(1157);t.CONTENT_LENGTH_HEADER="Content-Length",t.UPLOAD_LENGTH_HEADER="Upload-Length",t.UPLOAD_OFFSET_HEADER="Upload-Offset",t.UPLOAD_METADATA_HEADER="Upload-Metadata",t.UPLOAD_METADATA_CHUNK_SIZE_KEY="chunkSize",t.UPLOAD_METADATA_NUMBER_OF_CHUNKS_KEY="numberOfChunks",t.UPLOAD_METADATA_ENCRYPTED_AES_KEY_KEY="encryptedAesKey",t.UPLOAD_METADATA_FILENAME_KEY="filename";t.EncryptableHttpStack=class EncryptableHttpStack{constructor(e,t,r){if(this.uploadAes=new Map,this.defaultStack=e,!t)throw new Error("Vault is required");if(this.vault=t,t.encrypted){if(!t.__keys__||0===t.__keys__.length)throw new Error("Encrypted vault has no keys");this.vaultEncryption=new o.VaultEncryption({vaultKeys:t.__keys__,userEncrypter:r})}}createRequest(e,r){const o=this.defaultStack.createRequest(e,r);if("POST"!==e&&"PATCH"!==e&&"HEAD"!==e)return o;if(!this.vault.encrypted)return o;let c=null;"PATCH"!==e&&"HEAD"!==e||(c=r.split("/").pop());const u=o.send.bind(o);return o.send=async h=>{let l,p,d=h;if("POST"===e||"PATCH"===e){p=c&&this.uploadAes.has(c)?this.uploadAes.get(c):await this.vaultEncryption.generateAesKey();const u=await(0,i.tusFileToUint8Array)(h),l=await(0,n.encryptAes)(u,p.aesKey,!1);o.getUnderlyingObject()||o.setHeader(t.CONTENT_LENGTH_HEADER,l.byteLength.toString()),d=l;const y=this.getMetadata(o,t.UPLOAD_METADATA_FILENAME_KEY)||"unnamed",_=await this.vaultEncryption.encryptHybrid((0,s.stringToArray)(y));this.putMetadata(o,t.UPLOAD_METADATA_FILENAME_KEY,(0,s.stringToBase64)(_));const g=o.getHeader(t.UPLOAD_LENGTH_HEADER);if(g){const e=parseInt(g),r=Math.ceil(e/a.CHUNK_SIZE_IN_BYTES),i=e+r*(n.AUTH_TAG_LENGTH_IN_BYTES+n.IV_LENGTH_IN_BYTES);o.setHeader(t.UPLOAD_LENGTH_HEADER,i.toString()),this.putMetadata(o,t.UPLOAD_METADATA_NUMBER_OF_CHUNKS_KEY,(0,s.stringToBase64)(r.toString())),this.putMetadata(o,t.UPLOAD_METADATA_CHUNK_SIZE_KEY,(0,s.stringToBase64)(a.ENCRYPTED_CHUNK_SIZE_IN_BYTES.toString())),this.putMetadata(o,t.UPLOAD_METADATA_ENCRYPTED_AES_KEY_KEY,(0,s.stringToBase64)((0,s.jsonToBase64)(p.encryptedAesKey)))}const f=o.getHeader(t.UPLOAD_OFFSET_HEADER);if(f){const e=Math.ceil(parseInt(f)/a.CHUNK_SIZE_IN_BYTES),r=parseInt(f)+e*(n.AUTH_TAG_LENGTH_IN_BYTES+n.IV_LENGTH_IN_BYTES);o.setHeader(t.UPLOAD_OFFSET_HEADER,r.toString())}if(o._xhr){const t=o._xhr,{upload:i,withCredentials:s}=t;t.abort();const a=new XMLHttpRequest;a.open(e,r,!0),Object.entries(o._headers).forEach((([e,t])=>{a.setRequestHeader(e,t)})),a.upload.onprogress=i.onprogress,a.withCredentials=s,o._xhr=a}}l=await u(d);const y=l.getHeader("Location");if(y&&!c&&(c=y.split("/").pop()),c){if(!p)if(this.uploadAes.has(c))p=this.uploadAes.get(c);else{const e=this.getMetadata(l,t.UPLOAD_METADATA_ENCRYPTED_AES_KEY_KEY);if(e&&this.vaultEncryption){p={aesKey:await this.vaultEncryption.decryptAesKey(e),encryptedAesKey:(0,s.base64ToJson)(e)}}}p&&!this.uploadAes.has(c)&&this.uploadAes.set(c,p)}const _=parseInt(l.getHeader(t.UPLOAD_OFFSET_HEADER)),g=_-Math.ceil(_/a.ENCRYPTED_CHUNK_SIZE_IN_BYTES)*(n.AUTH_TAG_LENGTH_IN_BYTES+n.IV_LENGTH_IN_BYTES),f=l.getHeader.bind(l);return l.getHeader=e=>e===t.UPLOAD_OFFSET_HEADER?g.toString():f(e),l},o}getName(){return"EncryptableHttpStack"}putMetadata(e,r,i){const s=(e.getHeader(t.UPLOAD_METADATA_HEADER)?.split(",")??[]).filter((e=>!e.startsWith(`${r} `)));s.push(`${r} ${i}`);const a=s.join(",");e.setHeader(t.UPLOAD_METADATA_HEADER,a)}getMetadata(e,r){const i=e.getHeader(t.UPLOAD_METADATA_HEADER);if(!i)return null;const a=i.split(",").find((e=>e.startsWith(r)));return a?(0,s.base64ToString)(a.split(" ")[1]):null}}},9154:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.apiConfig=void 0;const i=r(3491);t.apiConfig=e=>{switch(e){case i.Envs.PROD:default:return{apiUrl:"https://api.tusky.io",cdnUrl:"https://cdn.tusky.io",gqlUrl:"https://zt4r4p7omrgmrfirr6322xawee.appsync-api.eu-central-1.amazonaws.com/graphql"};case i.Envs.DEV:return{apiUrl:"https://dev-api.tusky.io",cdnUrl:"https://dev-cdn.tusky.io",gqlUrl:"https://oruws6zna5adpg7dhbubrof2je.appsync-api.eu-central-1.amazonaws.com/graphql"};case i.Envs.LOCAL:return{apiUrl:"http://localhost:3100",cdnUrl:"http://localhost:3100/data",gqlUrl:"https://oruws6zna5adpg7dhbubrof2je.appsync-api.eu-central-1.amazonaws.com/graphql"}}}},9469:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Encrypter=void 0;const i=r(7604),s=r(5334),a=r(6408);class Encrypter{constructor(e){if(this.keypair=e.keypair,this.publicKey=e.publicKey||this.keypair?.getPublicKey(),!this.publicKey)throw new a.IncorrectEncryptionKey(new Error("Missing public key configuration. Please provide X25519 public key."))}async encrypt(e){const t=await(0,i.encryptWithPublicKey)(this.publicKey,e);return(0,s.jsonToBase64)(t)}async decrypt(e){if(!this.keypair)throw new a.IncorrectEncryptionKey(new Error("Missing keypair configuration. Please provide X25519 key pair."));return(0,i.decryptWithPrivateKey)(this.keypair.getPrivateKey(),(0,s.base64ToJson)(e))}}t.default=Encrypter,t.Encrypter=Encrypter},9606:e=>{e.exports=require("web-streams-polyfill/ponyfill")},9615:e=>{e.exports=require("libsodium-wrappers")},9849:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotEnoughStorage=void 0;const i=r(587);class NotEnoughStorage extends i.TuskyError{constructor(e,t){super(e,t),this.statusCode=402}}t.NotEnoughStorage=NotEnoughStorage},9896:t=>{t.exports=e(import.meta.url)("fs")},9920:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnokiClient=t.enokiConfig=t.ENOKI_API_URL=void 0;const i=r(4771),s=r(1377),a=r(3491);t.ENOKI_API_URL="https://api.enoki.mystenlabs.com/v1";t.enokiConfig=e=>{switch(e){case a.Envs.PROD:return{publicApiKey:"enoki_public_5313f34194cbfb93bb60354118d85ada"};case a.Envs.DEV:default:return{publicApiKey:"enoki_public_b0c8cf52ada845c7dfbfe8eef1e9ded2"}}};class EnokiClient{constructor(e){if(this.apiKey=e.apiKey||(0,t.enokiConfig)(e.env).publicApiKey,this.network=e.network||"testnet",!this.apiKey)throw new Error("Missing api key configuration. Please provide Enoki API key.")}async getZkLogin(e){const r=await fetch(t.ENOKI_API_URL+"/zklogin",{method:"GET",headers:{"Content-Type":"application/json","zklogin-jwt":e,Authorization:`Bearer ${this.apiKey}`}});if(!r.ok)throw s.logger.error(r),new i.Unauthorized("Invalid authorization.");return(await r.json()).data}async createZkLoginNonce(e){const r=await fetch(t.ENOKI_API_URL+"/zklogin/nonce",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({network:this.network,ephemeralPublicKey:e.getPublicKey().toSuiPublicKey(),additionalEpochs:2})});if(!r.ok)throw s.logger.error(r),new i.Unauthorized("Invalid authorization.");return(await r.json()).data}}t.default=EnokiClient,t.EnokiClient=EnokiClient},9949:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tusky=void 0;const s=r(1035),a=r(1377),n=r(6385),o=r(4293),c=r(6705),u=r(6957),h=r(6194),l=r(2866),p=r(2228),d=r(1984),y=r(4164),_=r(4819),g=r(8787),f=r(9469),v=r(679),w=r(4007),m=i(r(5779)),E=r(781),b=r(6219);t.Tusky=class Tusky{get me(){return new _.MeModule(this.getConfig())}get folder(){return new n.FolderModule(this.getConfig())}get nft(){return new o.NFTModule(this.getConfig())}get vault(){return new c.VaultModule(this.getConfig())}get file(){return new h.FileModule(this.getConfig())}get zip(){return new l.ZipModule(this.getConfig())}get trash(){return new v.TrashModule(this.getConfig())}get apiKey(){return new g.ApiKeyModule(this.getConfig())}get storage(){return new p.StorageModule(this.getConfig())}get auth(){return this._auth}static async init(e){const t=new b.TuskyBuilder;return e.env&&t.useEnv(e.env),e.encrypter&&t.useEncrypter(e.encrypter),e.logger&&t.useLogger(e.logger),e.clientName&&t.useClientName(e.clientName),e.wallet&&t.useWallet(e.wallet),e.apiKey&&t.useApiKey(e.apiKey),e.oauth&&t.useOAuth(e.oauth),t.build()}async signOut(){return await this.me.clearEncryptionSession(),this._auth.signOut(),this}async addEncrypter(e){if(e){if(e.keypair)this._encrypter=new f.Encrypter({keypair:e.keypair});else if(e.password){if((await this.me.get()).encPrivateKey){a.logger.info("Retrieve and decrypt existing user encryption content with password");const{keypair:t}=await this.me.importEncryptionSessionFromPassword(e.password);this._encrypter=new f.Encrypter({keypair:t})}else{a.logger.info("Generate new user encryption context");const{keypair:t}=await this.me.setupPassword(e.password);this._encrypter=new f.Encrypter({keypair:t})}}else if(e.keystore){if(!(await this.me.get()).encPrivateKey)throw new w.Conflict("The user needs to configure their encryption password/backup phrase.");try{a.logger.info("Retrieve and decrypt existing user encryption content from keystore");const{keypair:e}=await this.me.importEncryptionSessionFromKeystore();this._encrypter=new f.Encrypter({keypair:e})}catch(e){throw a.logger.error(e),new w.Conflict("The user needs to provide the password again.")}}return this}}getConfig(){return{api:this.api,pubsub:this.pubsub,auth:this._auth,encrypter:this._encrypter,env:this._env,storage:this._storage,address:this._auth?.getAddress()}}constructor(e={}){this._encrypter=e.encrypter,this._env={...this.getConfig(),...e}.env||d.DEFAULT_ENV,this._storage=e.storage||(0,E.defaultStorage)(),this._auth=e.auth?e.auth:new y.Auth({...e,...this.getConfig()}),this.api=e.api?e.api:new s.TuskyApi(this.getConfig()),this.pubsub=new m.default({env:this._env}),u.CacheBusters.cache=e?.cache}}},9987:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encrypted=t.Encryptable=void 0,r(1321);const i=r(5334),s=r(1157);t.Encryptable=class Encryptable{constructor(e){this.__keys__=e}async decryptPrivateKey(e,t){const r=this.__keys__.find((t=>t.publicKey===e)).encPrivateKey;return await t.decrypt(r)}async decrypt(e){return this.__encryptProps__&&await Promise.all(Array.from(this.__encryptProps__.values()).map((async t=>{if(!this[t])return this[t];const r=new s.VaultEncryption({vaultKeys:this.__keys__,userEncrypter:e}),a=(0,i.arrayToString)(await r.decryptHybrid(this[t]));return this[t]=a,a}))),await Promise.all(Object.keys(this).map((async e=>{this[e]&&(this[e].__keys__&&this[e].__keys__.length&&this[e].decrypt?await this[e].decrypt():Array.isArray(this[e])&&await Promise.all(this[e].map((async e=>{e&&e.__keys__&&e.__keys__.length&&e.decrypt&&await e.decrypt()}))))}))),Promise.resolve()}async encrypt(){return this.__encryptProps__&&await Promise.all(Array.from(this.__encryptProps__.values()).map((async e=>{if(!this[e])return this[e]}))),await Promise.all(Object.keys(this).map((async e=>{this[e]&&(this[e].__keys__&&this[e].__keys__.length&&this[e].encrypt?await this[e].encrypt():Array.isArray(this[e])&&await Promise.all(this[e].map((async e=>{e&&e.__keys__&&e.__keys__.length&&e.encrypt&&await e.encrypt()}))))}))),Promise.resolve()}},t.encrypted=function encrypted(){return function(e,t){e.__encryptProps__||(e.__encryptProps__=new Set),e.__encryptProps__.add(t)}}}},r={};function __webpack_require__(e){var i=r[e];if(void 0!==i)return i.exports;var s=r[e]={exports:{}};return t[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);__webpack_require__(7729);